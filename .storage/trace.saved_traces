{
  "version": 1,
  "minor_version": 1,
  "key": "trace.saved_traces",
  "data": {
    "automation.aut_ha_startup": [
      {
        "extended_dict": {
          "last_step": "action/0",
          "run_id": "91b2eb5a725fd59044f711c2cbe78b63",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.560854+00:00",
            "finish": "2025-08-15T13:24:37.572962+00:00"
          },
          "domain": "automation",
          "item_id": "aut_ha_startup",
          "trigger": "Home Assistant starting",
          "trace": {
            "trigger/0": [
              {
                "path": "trigger/0",
                "timestamp": "2025-08-15T13:24:22.560895+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.aut_ha_startup",
                    "state": "on",
                    "attributes": {
                      "id": "aut_ha_startup",
                      "last_triggered": "2025-08-14T20:27:21.072986+00:00",
                      "mode": "single",
                      "current": 0,
                      "friendly_name": "aut ha startup",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.875294+00:00",
                    "last_reported": "2025-08-15T13:24:10.875294+00:00",
                    "last_updated": "2025-08-15T13:24:10.875294+00:00",
                    "context": {
                      "id": "01K2PYDWZVW81F0Q21F4AY9TBQ",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "0",
                    "idx": "0",
                    "alias": null,
                    "platform": "homeassistant",
                    "event": "start",
                    "description": "Home Assistant starting"
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:24:22.561095+00:00",
                "child_id": {
                  "domain": "script",
                  "item_id": "scr_ha_startup",
                  "run_id": "9a75aad571c3258c265c6533155bdb6e"
                },
                "changed_variables": {
                  "context": {
                    "id": "01K2PYE8D06KMQZY0XQK1QW49P",
                    "parent_id": null,
                    "user_id": null
                  }
                },
                "result": {
                  "params": {
                    "domain": "script",
                    "service": "scr_ha_startup",
                    "service_data": {},
                    "target": {}
                  },
                  "running_script": true
                }
              }
            ]
          },
          "config": {
            "id": "aut_ha_startup",
            "alias": "aut ha startup",
            "initial_state": true,
            "trigger": [
              {
                "platform": "homeassistant",
                "event": "start"
              }
            ],
            "actions": [
              {
                "action": "script.scr_ha_startup"
              }
            ]
          },
          "blueprint_inputs": null,
          "context": {
            "id": "01K2PYE8D06KMQZY0XQK1QW49P",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/0",
          "run_id": "91b2eb5a725fd59044f711c2cbe78b63",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.560854+00:00",
            "finish": "2025-08-15T13:24:37.572962+00:00"
          },
          "domain": "automation",
          "item_id": "aut_ha_startup",
          "trigger": "Home Assistant starting"
        }
      }
    ],
    "script.scr_ha_startup": [
      {
        "extended_dict": {
          "last_step": "sequence/4/then/0",
          "run_id": "9a75aad571c3258c265c6533155bdb6e",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.561243+00:00",
            "finish": "2025-08-15T13:24:37.571225+00:00"
          },
          "domain": "script",
          "item_id": "scr_ha_startup",
          "trace": {
            "sequence/0": [
              {
                "path": "sequence/0",
                "timestamp": "2025-08-15T13:24:22.561424+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "script.scr_ha_startup",
                    "state": "off",
                    "attributes": {
                      "last_triggered": "2025-08-14T20:27:21.073410+00:00",
                      "mode": "single",
                      "current": 0,
                      "friendly_name": "scr_ha_startup"
                    },
                    "last_changed": "2025-08-15T13:24:03.705250+00:00",
                    "last_reported": "2025-08-15T13:24:03.705250+00:00",
                    "last_updated": "2025-08-15T13:24:03.705250+00:00",
                    "context": {
                      "id": "01K2PYDNZS6KSMHV01NCYHC4KR",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "context": {
                    "id": "01K2PYE8D06KMQZY0XQK1QW49P",
                    "parent_id": null,
                    "user_id": null
                  }
                },
                "result": {
                  "delay": 15.0,
                  "done": true
                }
              }
            ],
            "sequence/1": [
              {
                "path": "sequence/1",
                "timestamp": "2025-08-15T13:24:37.563501+00:00",
                "result": {
                  "params": {
                    "domain": "input_boolean",
                    "service": "turn_off",
                    "service_data": {},
                    "target": {
                      "entity_id": [
                        "input_boolean.inp_bool_announcements"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "sequence/2": [
              {
                "path": "sequence/2",
                "timestamp": "2025-08-15T13:24:37.564438+00:00",
                "result": {
                  "params": {
                    "domain": "input_boolean",
                    "service": "turn_off",
                    "service_data": {},
                    "target": {
                      "entity_id": [
                        "input_boolean.inp_bool_sleeping"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "sequence/3": [
              {
                "path": "sequence/3",
                "timestamp": "2025-08-15T13:24:37.565027+00:00",
                "result": {
                  "choice": "then"
                }
              }
            ],
            "sequence/3/if": [
              {
                "path": "sequence/3/if",
                "timestamp": "2025-08-15T13:24:37.565214+00:00",
                "result": {
                  "result": true
                }
              }
            ],
            "sequence/3/if/condition/0": [
              {
                "path": "sequence/3/if/condition/0",
                "timestamp": "2025-08-15T13:24:37.565285+00:00",
                "result": {
                  "result": true,
                  "entities": [
                    "input_datetime.announcements_disable",
                    "input_datetime.announcements_enable"
                  ]
                }
              }
            ],
            "sequence/3/then/0": [
              {
                "path": "sequence/3/then/0",
                "timestamp": "2025-08-15T13:24:37.566018+00:00",
                "result": {
                  "params": {
                    "domain": "input_boolean",
                    "service": "turn_on",
                    "service_data": {},
                    "target": {
                      "entity_id": [
                        "input_boolean.inp_bool_announcements"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "sequence/4": [
              {
                "path": "sequence/4",
                "timestamp": "2025-08-15T13:24:37.566758+00:00",
                "result": {
                  "choice": "then"
                }
              }
            ],
            "sequence/4/if": [
              {
                "path": "sequence/4/if",
                "timestamp": "2025-08-15T13:24:37.566923+00:00",
                "result": {
                  "result": true
                }
              }
            ],
            "sequence/4/if/condition/0": [
              {
                "path": "sequence/4/if/condition/0",
                "timestamp": "2025-08-15T13:24:37.566981+00:00",
                "result": {
                  "result": true,
                  "entities": [
                    "input_datetime.assume_awake",
                    "input_datetime.assume_asleep"
                  ]
                }
              }
            ],
            "sequence/4/then/0": [
              {
                "path": "sequence/4/then/0",
                "timestamp": "2025-08-15T13:24:37.567505+00:00",
                "result": {
                  "params": {
                    "domain": "input_boolean",
                    "service": "turn_off",
                    "service_data": {},
                    "target": {
                      "entity_id": [
                        "input_boolean.inp_bool_sleeping",
                        "input_boolean.inp_bool_visitor_while_sleeping_flag"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "sequence": [
              {
                "delay": "00:00:15"
              },
              {
                "action": "input_boolean.turn_off",
                "target": {
                  "entity_id": "input_boolean.inp_bool_announcements"
                }
              },
              {
                "action": "input_boolean.turn_off",
                "target": {
                  "entity_id": "input_boolean.inp_bool_sleeping"
                }
              },
              {
                "if": [
                  {
                    "condition": "template",
                    "value_template": "{{ ( as_timestamp(now(), '')| timestamp_custom('%H:%M:%S', true, '') > (states('input_datetime.announcements_enable') ) )  and \n  ( as_timestamp(now(), '')| timestamp_custom('%H:%M:%S', true, '') < (states('input_datetime.announcements_disable') ) ) }}\n"
                  }
                ],
                "then": [
                  {
                    "action": "input_boolean.turn_on",
                    "target": {
                      "entity_id": "input_boolean.inp_bool_announcements"
                    }
                  }
                ]
              },
              {
                "if": [
                  {
                    "condition": "template",
                    "value_template": "{{ ( as_timestamp(now(), '')| timestamp_custom('%H:%M:%S', true, '') > (states('input_datetime.assume_awake') ) )  and \n  ( as_timestamp(now(), '')| timestamp_custom('%H:%M:%S', true, '') < (states('input_datetime.assume_asleep') ) ) }}\n"
                  }
                ],
                "then": [
                  {
                    "action": "input_boolean.turn_off",
                    "target": {
                      "entity_id": [
                        "input_boolean.inp_bool_sleeping",
                        "input_boolean.inp_bool_visitor_while_sleeping_flag"
                      ]
                    }
                  }
                ]
              }
            ]
          },
          "blueprint_inputs": null,
          "context": {
            "id": "01K2PYE8D06KMQZY0XQK1QW49P",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "sequence/4/then/0",
          "run_id": "9a75aad571c3258c265c6533155bdb6e",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.561243+00:00",
            "finish": "2025-08-15T13:24:37.571225+00:00"
          },
          "domain": "script",
          "item_id": "scr_ha_startup"
        }
      }
    ],
    "automation.aut_update_ys_cell_ble_tracker": [
      {
        "extended_dict": {
          "last_step": "action/0",
          "run_id": "116aa9b8bf9c8781850ee3b51374d586",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.571916+00:00",
            "finish": "2025-08-15T13:24:22.572622+00:00"
          },
          "domain": "automation",
          "item_id": "aut_update_ys_cell_ble_tracker",
          "trigger": "Home Assistant starting",
          "trace": {
            "trigger/1": [
              {
                "path": "trigger/1",
                "timestamp": "2025-08-15T13:24:22.571947+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.aut_update_ys_cell_ble_tracker",
                    "state": "on",
                    "attributes": {
                      "id": "aut_update_ys_cell_ble_tracker",
                      "last_triggered": "2025-08-15T12:56:05.938380+00:00",
                      "mode": "single",
                      "current": 0,
                      "friendly_name": "aut update ys cell ble tracker",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.878778+00:00",
                    "last_reported": "2025-08-15T13:24:10.878778+00:00",
                    "last_updated": "2025-08-15T13:24:10.878778+00:00",
                    "context": {
                      "id": "01K2PYDWZYF2VAAT9TWJSKAK23",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "1",
                    "idx": "1",
                    "alias": null,
                    "platform": "homeassistant",
                    "event": "start",
                    "description": "Home Assistant starting"
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:24:22.572149+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYE8DB4Q7GTKZWZ7W33AD1",
                    "parent_id": null,
                    "user_id": null
                  }
                },
                "result": {
                  "params": {
                    "domain": "device_tracker",
                    "service": "see",
                    "service_data": {
                      "dev_id": "ys_cell_ble",
                      "location_name": "home"
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "id": "aut_update_ys_cell_ble_tracker",
            "alias": "aut update ys cell ble tracker",
            "mode": "single",
            "max_exceeded": "silent",
            "trigger": [
              {
                "platform": "state",
                "entity_id": "sensor.ys_cell_ble_room",
                "to": null
              },
              {
                "platform": "homeassistant",
                "event": "start"
              }
            ],
            "actions": [
              {
                "data": {
                  "dev_id": "ys_cell_ble",
                  "location_name": "{% if states('sensor.ys_cell_ble_room') != 'not_home' -%}\n  home\n{%- else -%}\n  not_home\n{%- endif %}\n"
                },
                "action": "device_tracker.see"
              }
            ]
          },
          "blueprint_inputs": null,
          "context": {
            "id": "01K2PYE8DB4Q7GTKZWZ7W33AD1",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/0",
          "run_id": "116aa9b8bf9c8781850ee3b51374d586",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.571916+00:00",
            "finish": "2025-08-15T13:24:22.572622+00:00"
          },
          "domain": "automation",
          "item_id": "aut_update_ys_cell_ble_tracker",
          "trigger": "Home Assistant starting"
        }
      }
    ],
    "automation.aut_update_kt_cell_ble_tracker": [
      {
        "extended_dict": {
          "last_step": "action/0",
          "run_id": "1c64a32896c79f52f2481705d652a94c",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.572864+00:00",
            "finish": "2025-08-15T13:24:22.573426+00:00"
          },
          "domain": "automation",
          "item_id": "aut_update_kt_cell_ble_tracker",
          "trigger": "Home Assistant starting",
          "trace": {
            "trigger/1": [
              {
                "path": "trigger/1",
                "timestamp": "2025-08-15T13:24:22.572887+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.aut_update_kt_cell_ble_tracker",
                    "state": "on",
                    "attributes": {
                      "id": "aut_update_kt_cell_ble_tracker",
                      "last_triggered": "2025-08-14T20:27:21.088693+00:00",
                      "mode": "single",
                      "current": 0,
                      "friendly_name": "aut update kt cell ble tracker",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.878886+00:00",
                    "last_reported": "2025-08-15T13:24:10.878886+00:00",
                    "last_updated": "2025-08-15T13:24:10.878886+00:00",
                    "context": {
                      "id": "01K2PYDWZYDDKA6279JNGWNY1K",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "1",
                    "idx": "1",
                    "alias": null,
                    "platform": "homeassistant",
                    "event": "start",
                    "description": "Home Assistant starting"
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:24:22.573026+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYE8DCS24N252PSQAT432S",
                    "parent_id": null,
                    "user_id": null
                  }
                },
                "result": {
                  "params": {
                    "domain": "device_tracker",
                    "service": "see",
                    "service_data": {
                      "dev_id": "kt_cell_ble",
                      "location_name": "not_home"
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "id": "aut_update_kt_cell_ble_tracker",
            "alias": "aut update kt cell ble tracker",
            "mode": "single",
            "max_exceeded": "silent",
            "trigger": [
              {
                "platform": "state",
                "entity_id": "sensor.kt_cell_ble_room",
                "to": null
              },
              {
                "platform": "homeassistant",
                "event": "start"
              }
            ],
            "actions": [
              {
                "data": {
                  "dev_id": "kt_cell_ble",
                  "location_name": "{% if states('sensor.kt_cell_ble_room') != 'not_home' -%}\n  home\n{%- else -%}\n  not_home\n{%- endif %}\n"
                },
                "action": "device_tracker.see"
              }
            ]
          },
          "blueprint_inputs": null,
          "context": {
            "id": "01K2PYE8DCS24N252PSQAT432S",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/0",
          "run_id": "1c64a32896c79f52f2481705d652a94c",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:22.572864+00:00",
            "finish": "2025-08-15T13:24:22.573426+00:00"
          },
          "domain": "automation",
          "item_id": "aut_update_kt_cell_ble_tracker",
          "trigger": "Home Assistant starting"
        }
      }
    ],
    "automation.1710004236293": [
      {
        "extended_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "4f50af4cdedece980532a7b0426b5d73",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:25.094807+00:00",
            "finish": "2025-08-15T13:25:25.126302+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern",
          "trace": {
            "trigger/0": [
              {
                "path": "trigger/0",
                "timestamp": "2025-08-15T13:25:25.101557+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.awtrix_mega_weather",
                    "state": "on",
                    "attributes": {
                      "id": "1710004236293",
                      "last_triggered": "2025-08-15T13:25:20.097154+00:00",
                      "mode": "restart",
                      "current": 0,
                      "friendly_name": "awtrix_mega_weather",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.874702+00:00",
                    "last_reported": "2025-08-15T13:25:20.104612+00:00",
                    "last_updated": "2025-08-15T13:25:20.104612+00:00",
                    "context": {
                      "id": "01K2PYG0JYKJJC3PAKR53REW2Y",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "0",
                    "idx": "0",
                    "alias": null,
                    "platform": "time_pattern",
                    "now": "2025-08-15T09:25:25.094513-04:00",
                    "description": "time pattern"
                  },
                  "device_ids": [
                    "a8583420298728779e89f960f8079d14"
                  ],
                  "app_topic": "jeef_weather",
                  "topics": [
                    "awtrix-clock/custom/jeef_weather"
                  ],
                  "forecast_var": "weather.forecast_home",
                  "current_condition": "sunny",
                  "current_temp": 82,
                  "hours_to_show": 12,
                  "moon": "sensor.moon_phase",
                  "moon_phase": "waning_gibbous",
                  "moon_times": "sensor.ip_geo_location",
                  "moon_rise": "-:-",
                  "moon_set": "13:31",
                  "moon_alt": 50.388162613986886,
                  "moon_risen": true,
                  "when_show_moon": "night",
                  "show_moon": false,
                  "message_duration": 10,
                  "message_duration_riseset": 0,
                  "current_temp_var": "sensor.kflwildw56_local_temperature",
                  "temp_digits": 0,
                  "temp_suffix": "\u00b0",
                  "temp_text": "86\u00b0",
                  "text_available_width": 24,
                  "text_len": 10,
                  "text_x": 15.0,
                  "sun_event_minute_threshold": 30,
                  "sun_time_type": "Actual",
                  "sun_time_format": "%-I%M%p",
                  "icon_sunrise": "w-sunrise",
                  "icon_sunset": "w-sunset",
                  "show_sun_rise_set": false,
                  "sun_next_event": "sunset",
                  "sun_min_until_next_event": 642,
                  "sun_next_str": "807PM",
                  "sun_event_icon": "w-sunset",
                  "sun_event_payload": {
                    "icon": "w-sunset",
                    "text": "807PM",
                    "duration": 0
                  },
                  "sun_payload": {},
                  "icon_clear_night": "w-clear-night",
                  "use_moon_clear_night": true,
                  "use_moon_sunny_night": true,
                  "icon_cloudy": "w-cloudy",
                  "icon_exceptional": "w-exceptional",
                  "icon_fog": "w-fog",
                  "icon_hail": "w-hail",
                  "icon_lightning": "w-lightning",
                  "icon_lightning_rainy": "w-lightning-rainy",
                  "icon_partlycloudy": "w-partlycloudy",
                  "icon_pouring": "w-pouring",
                  "icon_rainy": "w-rainy",
                  "icon_snowy": "w-snowy",
                  "icon_snowy_rainy": "w-snowy-rainy",
                  "icon_sunny": "w-sunny",
                  "icon_windy": "w-windy",
                  "icon_windy_variant": "w-windy-variant",
                  "clear_night_dict": {
                    "full_moon": "2314",
                    "waning_gibbous": "2315",
                    "last_quarter": "2316",
                    "waning_crescent": "2317",
                    "new_moon": "2318",
                    "waxing_crescent": "2319",
                    "first_quarter": "2320",
                    "waxing_gibbous": "2321"
                  },
                  "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
                  "color_dict": {
                    "0.0": "#FEC4FF",
                    "10.0": "#D977DF",
                    "20.0": "#9545BC",
                    "30.0": "#4B379C",
                    "40.0": "#31B8DB",
                    "50.0": "#31DB8B",
                    "60.0": "#6ED228",
                    "70.0": "#FFFF28",
                    "80.0": "#F87E27",
                    "90.0": "#CF3927",
                    "100.0": "#A12527"
                  },
                  "icon_dict": {
                    "clear-night": "w-clear-night",
                    "cloudy": "w-cloudy",
                    "exceptional": "w-exceptional",
                    "fog": "w-fog",
                    "hail": "w-hail",
                    "lightning": "w-lightning",
                    "lightning-rainy": "w-lightning-rainy",
                    "partlycloudy": "w-partlycloudy",
                    "pouring": "w-pouring",
                    "rainy": "w-rainy",
                    "snowy": "w-snowy",
                    "snowy-rainy": "w-snowy-rainy",
                    "sunny": "w-sunny",
                    "windy": "w-windy",
                    "windy-variant": "w-windy-variant"
                  },
                  "icon": "w-sunny",
                  "moon_data": {
                    "db": [
                      23,
                      0,
                      8,
                      8,
                      [
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        13421772,
                        13421772,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        15790320,
                        13421772,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0
                      ]
                    ]
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:25:25.102310+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYG5F641VXA3KZZB8Q7GDY",
                    "parent_id": null,
                    "user_id": null
                  },
                  "forecast_response": {
                    "weather.forecast_home": {
                      "forecast": [
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T14:00:00+00:00",
                          "wind_bearing": 348.6,
                          "cloud_coverage": 7.0,
                          "uv_index": 3.9,
                          "temperature": 85,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 81
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T15:00:00+00:00",
                          "wind_bearing": 355.2,
                          "cloud_coverage": 18.7,
                          "uv_index": 6.6,
                          "temperature": 87,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 72
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T16:00:00+00:00",
                          "wind_bearing": 349.3,
                          "cloud_coverage": 21.1,
                          "uv_index": 9.1,
                          "temperature": 89,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 65
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T17:00:00+00:00",
                          "wind_bearing": 310.7,
                          "cloud_coverage": 18.0,
                          "uv_index": 10.5,
                          "temperature": 90,
                          "wind_speed": 2.67,
                          "precipitation": 0.0,
                          "humidity": 60
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T18:00:00+00:00",
                          "wind_bearing": 289.1,
                          "cloud_coverage": 12.5,
                          "uv_index": 10.4,
                          "temperature": 91,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 58
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T19:00:00+00:00",
                          "wind_bearing": 289.6,
                          "cloud_coverage": 12.5,
                          "uv_index": 8.7,
                          "temperature": 92,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 56
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T20:00:00+00:00",
                          "wind_bearing": 321.5,
                          "cloud_coverage": 10.9,
                          "uv_index": 6.1,
                          "temperature": 93,
                          "wind_speed": 3.6,
                          "precipitation": 0.01,
                          "humidity": 55
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T21:00:00+00:00",
                          "wind_bearing": 285.4,
                          "cloud_coverage": 58.6,
                          "uv_index": 3.4,
                          "temperature": 91,
                          "wind_speed": 7.83,
                          "precipitation": 0.02,
                          "humidity": 59
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T22:00:00+00:00",
                          "wind_bearing": 276.0,
                          "cloud_coverage": 78.9,
                          "uv_index": 1.4,
                          "temperature": 87,
                          "wind_speed": 6.71,
                          "precipitation": 0.0,
                          "humidity": 69
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T23:00:00+00:00",
                          "wind_bearing": 23.2,
                          "cloud_coverage": 61.7,
                          "uv_index": 0.3,
                          "temperature": 85,
                          "wind_speed": 5.59,
                          "precipitation": 0.0,
                          "humidity": 73
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T00:00:00+00:00",
                          "wind_bearing": 51.4,
                          "cloud_coverage": 30.5,
                          "uv_index": 0.0,
                          "temperature": 83,
                          "wind_speed": 4.23,
                          "precipitation": 0.0,
                          "humidity": 80
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T01:00:00+00:00",
                          "wind_bearing": 45.3,
                          "cloud_coverage": 33.6,
                          "uv_index": 0.0,
                          "temperature": 81,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 84
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T02:00:00+00:00",
                          "wind_bearing": 32.7,
                          "cloud_coverage": 17.2,
                          "uv_index": 0.0,
                          "temperature": 80,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 87
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T03:00:00+00:00",
                          "wind_bearing": 44.0,
                          "cloud_coverage": 3.9,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T04:00:00+00:00",
                          "wind_bearing": 40.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T05:00:00+00:00",
                          "wind_bearing": 356.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T06:00:00+00:00",
                          "wind_bearing": 345.7,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T07:00:00+00:00",
                          "wind_bearing": 326.0,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 94
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T08:00:00+00:00",
                          "wind_bearing": 345.1,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 95
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T09:00:00+00:00",
                          "wind_bearing": 34.2,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.43,
                          "precipitation": 0.0,
                          "humidity": 96
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T10:00:00+00:00",
                          "wind_bearing": 345.8,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 1.12,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T11:00:00+00:00",
                          "wind_bearing": 343.2,
                          "cloud_coverage": 1.6,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.87,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T12:00:00+00:00",
                          "wind_bearing": 1.6,
                          "cloud_coverage": 7.8,
                          "uv_index": 0.4,
                          "temperature": 79,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 93
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T13:00:00+00:00",
                          "wind_bearing": 12.7,
                          "cloud_coverage": 6.2,
                          "uv_index": 1.6,
                          "temperature": 82,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 82
                        }
                      ]
                    }
                  }
                },
                "result": {
                  "params": {
                    "domain": "weather",
                    "service": "get_forecasts",
                    "service_data": {
                      "type": "hourly",
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    },
                    "target": {
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "action/1": [
              {
                "path": "action/1",
                "timestamp": "2025-08-15T13:25:25.106719+00:00"
              }
            ],
            "action/1/repeat/sequence/0": [
              {
                "path": "action/1/repeat/sequence/0",
                "timestamp": "2025-08-15T13:25:25.108646+00:00",
                "changed_variables": {
                  "repeat": {
                    "first": true,
                    "index": 1,
                    "last": true,
                    "item": "awtrix-clock/custom/jeef_weather"
                  }
                },
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "topic": "awtrix-clock/custom/jeef_weather",
                      "payload": {
                        "draw": [
                          {
                            "dp": [
                              8,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              9,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              10,
                              7,
                              "#D33F27"
                            ]
                          },
                          {
                            "dp": [
                              11,
                              7,
                              "#CC5127"
                            ]
                          },
                          {
                            "dp": [
                              12,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              13,
                              7,
                              "#C53527"
                            ]
                          },
                          {
                            "dp": [
                              14,
                              7,
                              "#C13327"
                            ]
                          },
                          {
                            "dp": [
                              15,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              16,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              17,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              18,
                              7,
                              "#EB6927"
                            ]
                          },
                          {
                            "dp": [
                              19,
                              7,
                              "#F37727"
                            ]
                          },
                          {
                            "dt": [
                              15.0,
                              1,
                              "86\u00b0",
                              "#EF7027"
                            ]
                          }
                        ],
                        "icon": "w-sunny",
                        "duration": 10,
                        "pushIcon": 2,
                        "lifetime": 120,
                        "lifetimeMode": 1,
                        "weather": "sunny"
                      }
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ],
            "action/1/repeat/sequence/1": [
              {
                "path": "action/1/repeat/sequence/1",
                "timestamp": "2025-08-15T13:25:25.119653+00:00",
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "qos": 0,
                      "retain": false,
                      "topic": "awtrix-clock/custom/jeef_weather_sun",
                      "payload": {}
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "mode": "restart",
            "variables": {
              "device_ids": [
                "a8583420298728779e89f960f8079d14"
              ],
              "app_topic": "jeef_weather",
              "topics": "{%- macro get_device_topic(device_id) %} {{ states((device_entities(device_id) | select('search','device_topic') | list)[0]) }} {%- endmacro %}\n{%- set ns = namespace(devices=[]) %} {%- for device_id in device_ids %}\n  {%- set device=get_device_topic(device_id)|replace(' ','') %}\n  {% set ns.devices = ns.devices + [ device ~ '/custom/' ~ app_topic] %}\n{%- endfor %} {{ ns.devices | reject('match','unavailable') | list}}",
              "forecast_var": "weather.forecast_home",
              "current_condition": "{{states(forecast_var)}}",
              "current_temp": "{{state_attr(forecast_var,'temperature')}}",
              "hours_to_show": 12,
              "moon": "sensor.moon_phase",
              "moon_phase": "{{states(moon)}}",
              "moon_times": "sensor.ip_geo_location",
              "moon_rise": "{{state_attr(moon_times,'moonrise')}}",
              "moon_set": "{{state_attr(moon_times,'moonset')}}",
              "moon_alt": "{{state_attr(moon_times,'moon_altitude')}}",
              "moon_risen": "{{moon_alt > 0}}",
              "when_show_moon": "night",
              "show_moon": "{%- if when_show_moon == 'always' %} True {%- elif when_show_moon == 'never' %} False {%- elif when_show_moon == 'risen' %} {{moon_risen}} {%- else %} {{state_attr('sun.sun', 'elevation') < 0 and moon_risen}} {%- endif %}",
              "message_duration": 10,
              "message_duration_riseset": 0,
              "current_temp_var": "sensor.kflwildw56_local_temperature",
              "temp_digits": 0,
              "temp_suffix": "\u00b0",
              "temp_text": "{%- macro round_and_set_temp(temp_var, temp_suffix, digits=0) -%} {%- if has_value(temp_var) -%}\n  {{ states(temp_var) | round(digits) ~ temp_suffix}} \n{%- else -%} {{current_temp ~ temp_suffix}} {%- endif -%} {%- endmacro -%} {{ round_and_set_temp(current_temp_var, temp_suffix, temp_digits)}}",
              "text_available_width": "{%- if show_moon %}16{%- else %}24{%- endif %}\n",
              "text_len": "{%- macro get_text_len(string) %} {%- set length = namespace(value=0) %} {%- for char in string %}\n  {%- if char.isdigit() %}\n    {%- set length.value = length.value + 3 %}\n  {%- elif char == '\u00b0' %}\n    {%- set length.value = length.value + 2 %}\n  {%- elif char == '.' %}\n    {%- set length.value = length.value + 1 %}\n  {%- elif char in ['-','C','F'] %}\n    {%- set length.value = length.value + 3 %}\n  {%- else %}\n    {%- set length.value = length.value + 1 %}\n  {%- endif %}\n  {%- if not loop.last %}\n    {%- set length.value = length.value + 1 %}{%- endif -%}\n{%- endfor -%} {{ length.value }} {%- endmacro %}\n{{get_text_len(temp_text)}}",
              "text_x": "{{8 + ((text_available_width - text_len)/2)}}",
              "sun_event_minute_threshold": 30,
              "sun_time_type": "Actual",
              "sun_time_format": "%-I%M%p",
              "icon_sunrise": "w-sunrise",
              "icon_sunset": "w-sunset",
              "show_sun_rise_set": false,
              "sun_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(ts_set < ts_rise,'sunset','sunrise') }}",
              "sun_min_until_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(sun_next_event == 'sunrise',(ts_rise - utcnow()|as_timestamp) / 60,(ts_set - utcnow()|as_timestamp) / 60) | round(0) }}",
              "sun_next_str": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {%- if sun_time_type == 'Actual' %}\n  {{ iif(sun_next_event == 'sunrise',(ts_rise | as_datetime | as_local).strftime(sun_time_format),  (ts_set | as_datetime | as_local).strftime(sun_time_format)) }}\n{%- else %} {#- relative time #}\n  {% set hours = sun_min_until_next_event // 60 %}\n  {% set remaining_minutes = sun_min_until_next_event % 60 %}\n\n  {% if hours == 0 %}\n      {{ remaining_minutes }} min\n  {% else %}\n      [\n        {\"t\":\"{{hours}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"h\", \"c\":\"#9c9d97\"},\n        {\"t\":\"{{remaining_minutes}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"m\", \"c\":\"#9c9d97\"}\n    ]\n  {% endif %}\n  \n{%- endif %}",
              "sun_event_icon": "{{ iif(sun_next_event == 'sunrise', icon_sunrise, icon_sunset) }}",
              "sun_event_payload": "{\"icon\":\"{{sun_event_icon}}\", \"text\":\"{{sun_next_str}}\", \"duration\": {{message_duration_riseset}}}",
              "sun_payload": "{%- if show_sun_rise_set %} {{ iif(sun_event_minute_threshold >= sun_min_until_next_event, sun_event_payload, \"{}\") }} {%- else %} {} {%- endif %}",
              "icon_clear_night": "w-clear-night",
              "use_moon_clear_night": true,
              "use_moon_sunny_night": true,
              "icon_cloudy": "w-cloudy",
              "icon_exceptional": "w-exceptional",
              "icon_fog": "w-fog",
              "icon_hail": "w-hail",
              "icon_lightning": "w-lightning",
              "icon_lightning_rainy": "w-lightning-rainy",
              "icon_partlycloudy": "w-partlycloudy",
              "icon_pouring": "w-pouring",
              "icon_rainy": "w-rainy",
              "icon_snowy": "w-snowy",
              "icon_snowy_rainy": "w-snowy-rainy",
              "icon_sunny": "w-sunny",
              "icon_windy": "w-windy",
              "icon_windy_variant": "w-windy-variant",
              "clear_night_dict": "{{ dict({\n  'full_moon': '2314',\n  'waning_gibbous': '2315',\n  'last_quarter': '2316',\n  'waning_crescent': '2317',\n  'new_moon': '2318',\n  'waxing_crescent': '2319',\n  'first_quarter': '2320',\n  'waxing_gibbous': '2321'}) }}",
              "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
              "color_dict": "{% set b = color_matrix_json | from_json %}     {%- set ns = namespace(tuples=[]) %} {%- for k,v in b | items -%}\n  {%- set key = k|float -%}\n  {%- set ns.tuples = ns.tuples + [(key,v)] %}      \n{% endfor %} {{ dict.from_keys(ns.tuples) }}",
              "icon_dict": "{{ dict({'clear-night': icon_clear_night, 'cloudy': icon_cloudy, 'exceptional': icon_exceptional, 'fog': icon_fog, 'hail': icon_hail, 'lightning': icon_lightning, 'lightning-rainy': icon_lightning_rainy, 'partlycloudy': icon_partlycloudy, 'pouring': icon_pouring, 'rainy': icon_rainy, 'snowy': icon_snowy, 'snowy-rainy': icon_snowy_rainy, 'sunny': icon_sunny, 'windy': icon_windy,  'windy-variant': icon_windy_variant})}}",
              "icon": "{%- if ((current_condition == 'clear_night') and use_moon_clear_night) %}\n  {{clear_night_dict[moon_phase]}}\n{%- elif (sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%}\n  \n{%- else %}\n  {{ icon_dict[current_condition] }}\n{%- endif %}\n",
              "moon_data": "{%- macro draw_moon(phase,x=22,y=0) %}\n  {%- if phase == 'first_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,15790320,14079702,14079702,0,3355443,3355443,3355443,3355443,13355979,13355979,14079702,14079702,3355443,3355443,1644825,3355443,13355979,15790320,15790320,14079702,3355443,3355443,1644825,3355443,15790320,15790320,15790320,14079702,3355443,3355443,3355443,3355443,15790320,13355979,14079702,14079702,0,3355443,3355443,3355443,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'full_moon'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,14079702,14079702,0,0,0,14079702,14079702,15790320,15790320,14079702,14079702,0,14079702,14079702,15790320,15790320,11974326,11974326,14079702,14079702,14079702,15790320,11974326,15790320,11974326,15790320,15790320,14079702,14079702,15790320,11974326,15790320,15790320,15790320,15790320,14079702,14079702,14079702,15790320,15790320,15790320,11974326,14079702,14079702,0,14079702,14079702,11974326,15790320,14079702,14079702,0,0,0,14079702,14079702,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'last_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3487029,3487029,0,0,0,14079702,14079702,15790320,3487029,3487029,3487029,0,14079702,14079702,15790320,15790320,1907997,1907997,3487029,3487029,14079702,15790320,13553358,15790320,1907997,3487029,3487029,3487029,14079702,15790320,13553358,15790320,3487029,3487029,3487029,3487029,14079702,14079702,15790320,15790320,3487029,1907997,3487029,3487029,0,14079702,14079702,13553358,3487029,3487029,3487029,0,0,0,14079702,14079702,3487029,3487029,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'new_moon' %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,2763306,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,2763306,2763306,0,2763306,2763306,2763306,2763306,1842204,1842204,2763306,2763306,2763306,2763306,1842204,2763306,1842204,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,0,2763306,2763306,1842204,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,2763306,2763306,0,14079702,14079702,2763306,2763306,1842204,1842204,2763306,2763306,14079702,15790320,1842204,2763306,1842204,2763306,2763306,2763306,14079702,15790320,1842204,2763306,2763306,2763306,2763306,2763306,14079702,14079702,2763306,2763306,2763306,1842204,2763306,2763306,0,14079702,14079702,1842204,2763306,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3552822,3552822,0,0,0,14079702,14079702,15790320,15790320,3552822,3552822,0,14079702,14079702,15790320,15790320,13421772,13421772,3552822,3552822,14079702,15790320,13421772,15790320,13421772,15790320,3552822,3552822,14079702,15790320,13421772,15790320,15790320,15790320,3552822,3552822,14079702,14079702,15790320,15790320,15790320,13421772,3552822,3552822,0,14079702,14079702,13421772,15790320,3552822,3552822,0,0,0,14079702,14079702,3552822,3552822,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,3355443,14079702,14079702,0,3355443,3355443,3355443,3355443,1644825,1644825,14079702,14079702,3355443,3355443,1644825,3355443,1644825,3355443,15790320,14079702,3355443,3355443,1644825,3355443,3355443,3355443,15790320,14079702,3355443,3355443,3355443,3355443,3355443,1644825,14079702,14079702,0,3355443,3355443,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,15790320,14079702,14079702,0,3355443,3355443,15790320,15790320,12763842,12763842,14079702,14079702,3355443,3355443,12763842,15790320,12763842,15790320,15790320,14079702,3355443,3355443,12763842,15790320,15790320,15790320,15790320,14079702,3355443,3355443,15790320,15790320,15790320,12763842,14079702,14079702,0,3355443,3355443,12763842,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n{%- endmacro %}\n{%- if current_condition == 'clear-night' and use_moon_clear_night -%} {{draw_moon(moon_phase,0,0)}} {%- elif(sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%} {{draw_moon(moon_phase,0,0)}} {%- else -%} {{draw_moon(moon_phase,23,0)}} {%- endif -%}\n"
            },
            "triggers": [
              {
                "platform": "time_pattern",
                "seconds": "/5"
              },
              {
                "platform": "state",
                "entity_id": "weather.forecast_home",
                "id": "Changes",
                "enabled": true
              }
            ],
            "actions": [
              {
                "target": {
                  "entity_id": "{{forecast_var}}"
                },
                "data": {
                  "type": "hourly"
                },
                "response_variable": "forecast_response",
                "action": "weather.get_forecasts"
              },
              {
                "repeat": {
                  "for_each": "{{ topics }}",
                  "sequence": [
                    {
                      "data": {
                        "topic": "{{repeat.item}}",
                        "payload": "{%- set forecast = forecast_response[forecast_var]['forecast'] -%} {%- macro interpolate(dictionary, x) -%} {%- set sorted_keys = dictionary|dictsort -%} {%- set above = sorted_keys|selectattr('0', 'gt', x)|map(attribute='0')|list|first -%} {%- set below = sorted_keys|selectattr('0', 'lt', x)|map(attribute='0')|list|last -%}\n{#- Key matches x exactly -#} {%- if above is defined and dictionary[above] == x -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{%- elif below is defined and dictionary[below] == x -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Interpolation between two values -#} {%- elif below is defined and above is defined -%}\n  {%- set lower_value = dictionary[below] -%}\n  {%- set upper_value = dictionary[above] -%}\n  {%- set lower_rgb = lower_value[1:] -%}\n  {%- set upper_rgb = upper_value[1:] -%}\n\n  {%- set lower_r = lower_rgb[0:2]|int(base=16) -%}\n  {%- set lower_g = lower_rgb[2:4]|int(base=16) -%}\n  {%- set lower_b = lower_rgb[4:6]|int(base=16) -%}\n\n  {%- set upper_r = upper_rgb[0:2]|int(base=16) -%}\n  {%- set upper_g = upper_rgb[2:4]|int(base=16) -%}\n  {%- set upper_b = upper_rgb[4:6]|int(base=16) -%}\n\n  {%- set interpolation_factor = (x - below) / (above - below) -%}\n  {%- set interpolated_r = ((1 - interpolation_factor) * lower_r + interpolation_factor * upper_r)|int -%}\n  {%- set interpolated_g = ((1 - interpolation_factor) * lower_g + interpolation_factor * upper_g)|int -%}\n  {%- set interpolated_b = ((1 - interpolation_factor) * lower_b + interpolation_factor * upper_b)|int -%}\n\n  {%- set interpolated_hex = '#' ~ '%02X' % interpolated_r ~ '%02X' % interpolated_g ~ '%02X' % interpolated_b -%}\n  {{ interpolated_hex }}\n{#- Only below key available -#} {%- elif below is defined -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Only above key available -#} {%- elif above is defined -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{#- No matching keys available -#} {%- else -%}\n  No matching key found.\n{%- endif -%} {%- endmacro -%}\n{#- Define macro to get length of the forecast -#} {%- macro str_len(stringo) %} {%- if '.' in stringo %} {%- set char_count = (stringo | length) -1 %}{{char_count * 3 + 1 + char_count}} {%- else %} {%- set char_count = (stringo | length) %}{{char_count * 3 + (char_count - 1)}} {%- endif %} {%- endmacro %}\n{#- Define a macro to draw out the forecast lines#}\n  {%- macro draw_forecast_lines(x,hours,height) %}\n    {%- for hour in range(hours) %}\n      {%- if height == 0 %}\n        {\"dp\": [{{x+hour}},7,\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- else %}\n        {\"dl\": [{{x+hour}},7,{{x+hour}},{{7 - height}},\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- endif %}\n      {%- if hour+1 != hours %},{%endif%}\n    {%- endfor %}\n  {%- endmacro %}\n\n  {\n    \"draw\": [\n      {%- if hours_to_show > 0 %}\n      {{draw_forecast_lines(8,hours_to_show,0)}}\n    {%- endif %}\n    {%- if current_temp != 'unavailable' -%}\n    ,{\"dt\":[{{text_x}},1,\"{{temp_text}}\",\"{{interpolate(color_dict, current_temp | float)}}\"]}\n    {%- else -%}\n    {\"dt\":\"err\"}\n    {%- endif -%}\n\n    {% if show_moon %}\n    ,{{moon_data}}\n    {% endif %}\n    ],\n    \"icon\": \"{{icon}}\",\n    \"duration\": {{message_duration}},\n    \"pushIcon\": 2,\n    \"lifetime\": 120,\n    \"lifetimeMode\":1,\n    \"weather\": \"{{current_condition}}\"\n    }"
                      },
                      "action": "mqtt.publish"
                    },
                    {
                      "data": {
                        "qos": 0,
                        "retain": false,
                        "topic": "{{ repeat.item ~ '_sun'}} ",
                        "payload": "{{sun_payload}}\n"
                      },
                      "action": "mqtt.publish"
                    }
                  ]
                }
              }
            ],
            "conditions": [],
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather"
          },
          "blueprint_inputs": {
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather",
            "use_blueprint": {
              "path": "jeeftor/awtrix_weatherflow.yaml",
              "input": {
                "awtrix": [
                  "a8583420298728779e89f960f8079d14"
                ],
                "forecast_var": "weather.forecast_home",
                "forecast_temp_field": "temperature",
                "temp_suffix": "\u00b0",
                "current_temp_var": "sensor.kflwildw56_local_temperature",
                "moon": "sensor.moon_phase",
                "moon_rise_set": "sensor.ip_geo_location",
                "show_sun_rise_set": false,
                "message_duration_riseset": 0,
                "message_duration_forecast": 10,
                "hours_to_show": 12,
                "temp_digits": 0
              }
            }
          },
          "context": {
            "id": "01K2PYG5F641VXA3KZZB8Q7GDY",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "4f50af4cdedece980532a7b0426b5d73",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:25.094807+00:00",
            "finish": "2025-08-15T13:25:25.126302+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern"
        }
      },
      {
        "extended_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "0fe595a8d1d61d7188a7ef9292922ba4",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:30.094547+00:00",
            "finish": "2025-08-15T13:25:30.119300+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern",
          "trace": {
            "trigger/0": [
              {
                "path": "trigger/0",
                "timestamp": "2025-08-15T13:25:30.099691+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.awtrix_mega_weather",
                    "state": "on",
                    "attributes": {
                      "id": "1710004236293",
                      "last_triggered": "2025-08-15T13:25:25.101894+00:00",
                      "mode": "restart",
                      "current": 0,
                      "friendly_name": "awtrix_mega_weather",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.874702+00:00",
                    "last_reported": "2025-08-15T13:25:25.125093+00:00",
                    "last_updated": "2025-08-15T13:25:25.125093+00:00",
                    "context": {
                      "id": "01K2PYG5F641VXA3KZZB8Q7GDY",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "0",
                    "idx": "0",
                    "alias": null,
                    "platform": "time_pattern",
                    "now": "2025-08-15T09:25:30.094294-04:00",
                    "description": "time pattern"
                  },
                  "device_ids": [
                    "a8583420298728779e89f960f8079d14"
                  ],
                  "app_topic": "jeef_weather",
                  "topics": [
                    "awtrix-clock/custom/jeef_weather"
                  ],
                  "forecast_var": "weather.forecast_home",
                  "current_condition": "sunny",
                  "current_temp": 82,
                  "hours_to_show": 12,
                  "moon": "sensor.moon_phase",
                  "moon_phase": "waning_gibbous",
                  "moon_times": "sensor.ip_geo_location",
                  "moon_rise": "-:-",
                  "moon_set": "13:31",
                  "moon_alt": 50.388162613986886,
                  "moon_risen": true,
                  "when_show_moon": "night",
                  "show_moon": false,
                  "message_duration": 10,
                  "message_duration_riseset": 0,
                  "current_temp_var": "sensor.kflwildw56_local_temperature",
                  "temp_digits": 0,
                  "temp_suffix": "\u00b0",
                  "temp_text": "86\u00b0",
                  "text_available_width": 24,
                  "text_len": 10,
                  "text_x": 15.0,
                  "sun_event_minute_threshold": 30,
                  "sun_time_type": "Actual",
                  "sun_time_format": "%-I%M%p",
                  "icon_sunrise": "w-sunrise",
                  "icon_sunset": "w-sunset",
                  "show_sun_rise_set": false,
                  "sun_next_event": "sunset",
                  "sun_min_until_next_event": 642,
                  "sun_next_str": "807PM",
                  "sun_event_icon": "w-sunset",
                  "sun_event_payload": {
                    "icon": "w-sunset",
                    "text": "807PM",
                    "duration": 0
                  },
                  "sun_payload": {},
                  "icon_clear_night": "w-clear-night",
                  "use_moon_clear_night": true,
                  "use_moon_sunny_night": true,
                  "icon_cloudy": "w-cloudy",
                  "icon_exceptional": "w-exceptional",
                  "icon_fog": "w-fog",
                  "icon_hail": "w-hail",
                  "icon_lightning": "w-lightning",
                  "icon_lightning_rainy": "w-lightning-rainy",
                  "icon_partlycloudy": "w-partlycloudy",
                  "icon_pouring": "w-pouring",
                  "icon_rainy": "w-rainy",
                  "icon_snowy": "w-snowy",
                  "icon_snowy_rainy": "w-snowy-rainy",
                  "icon_sunny": "w-sunny",
                  "icon_windy": "w-windy",
                  "icon_windy_variant": "w-windy-variant",
                  "clear_night_dict": {
                    "full_moon": "2314",
                    "waning_gibbous": "2315",
                    "last_quarter": "2316",
                    "waning_crescent": "2317",
                    "new_moon": "2318",
                    "waxing_crescent": "2319",
                    "first_quarter": "2320",
                    "waxing_gibbous": "2321"
                  },
                  "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
                  "color_dict": {
                    "0.0": "#FEC4FF",
                    "10.0": "#D977DF",
                    "20.0": "#9545BC",
                    "30.0": "#4B379C",
                    "40.0": "#31B8DB",
                    "50.0": "#31DB8B",
                    "60.0": "#6ED228",
                    "70.0": "#FFFF28",
                    "80.0": "#F87E27",
                    "90.0": "#CF3927",
                    "100.0": "#A12527"
                  },
                  "icon_dict": {
                    "clear-night": "w-clear-night",
                    "cloudy": "w-cloudy",
                    "exceptional": "w-exceptional",
                    "fog": "w-fog",
                    "hail": "w-hail",
                    "lightning": "w-lightning",
                    "lightning-rainy": "w-lightning-rainy",
                    "partlycloudy": "w-partlycloudy",
                    "pouring": "w-pouring",
                    "rainy": "w-rainy",
                    "snowy": "w-snowy",
                    "snowy-rainy": "w-snowy-rainy",
                    "sunny": "w-sunny",
                    "windy": "w-windy",
                    "windy-variant": "w-windy-variant"
                  },
                  "icon": "w-sunny",
                  "moon_data": {
                    "db": [
                      23,
                      0,
                      8,
                      8,
                      [
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        13421772,
                        13421772,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        15790320,
                        13421772,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0
                      ]
                    ]
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:25:30.100325+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYGABEVTHWS9KM2PC8GTZ2",
                    "parent_id": null,
                    "user_id": null
                  },
                  "forecast_response": {
                    "weather.forecast_home": {
                      "forecast": [
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T14:00:00+00:00",
                          "wind_bearing": 348.6,
                          "cloud_coverage": 7.0,
                          "uv_index": 3.9,
                          "temperature": 85,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 81
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T15:00:00+00:00",
                          "wind_bearing": 355.2,
                          "cloud_coverage": 18.7,
                          "uv_index": 6.6,
                          "temperature": 87,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 72
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T16:00:00+00:00",
                          "wind_bearing": 349.3,
                          "cloud_coverage": 21.1,
                          "uv_index": 9.1,
                          "temperature": 89,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 65
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T17:00:00+00:00",
                          "wind_bearing": 310.7,
                          "cloud_coverage": 18.0,
                          "uv_index": 10.5,
                          "temperature": 90,
                          "wind_speed": 2.67,
                          "precipitation": 0.0,
                          "humidity": 60
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T18:00:00+00:00",
                          "wind_bearing": 289.1,
                          "cloud_coverage": 12.5,
                          "uv_index": 10.4,
                          "temperature": 91,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 58
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T19:00:00+00:00",
                          "wind_bearing": 289.6,
                          "cloud_coverage": 12.5,
                          "uv_index": 8.7,
                          "temperature": 92,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 56
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T20:00:00+00:00",
                          "wind_bearing": 321.5,
                          "cloud_coverage": 10.9,
                          "uv_index": 6.1,
                          "temperature": 93,
                          "wind_speed": 3.6,
                          "precipitation": 0.01,
                          "humidity": 55
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T21:00:00+00:00",
                          "wind_bearing": 285.4,
                          "cloud_coverage": 58.6,
                          "uv_index": 3.4,
                          "temperature": 91,
                          "wind_speed": 7.83,
                          "precipitation": 0.02,
                          "humidity": 59
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T22:00:00+00:00",
                          "wind_bearing": 276.0,
                          "cloud_coverage": 78.9,
                          "uv_index": 1.4,
                          "temperature": 87,
                          "wind_speed": 6.71,
                          "precipitation": 0.0,
                          "humidity": 69
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T23:00:00+00:00",
                          "wind_bearing": 23.2,
                          "cloud_coverage": 61.7,
                          "uv_index": 0.3,
                          "temperature": 85,
                          "wind_speed": 5.59,
                          "precipitation": 0.0,
                          "humidity": 73
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T00:00:00+00:00",
                          "wind_bearing": 51.4,
                          "cloud_coverage": 30.5,
                          "uv_index": 0.0,
                          "temperature": 83,
                          "wind_speed": 4.23,
                          "precipitation": 0.0,
                          "humidity": 80
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T01:00:00+00:00",
                          "wind_bearing": 45.3,
                          "cloud_coverage": 33.6,
                          "uv_index": 0.0,
                          "temperature": 81,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 84
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T02:00:00+00:00",
                          "wind_bearing": 32.7,
                          "cloud_coverage": 17.2,
                          "uv_index": 0.0,
                          "temperature": 80,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 87
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T03:00:00+00:00",
                          "wind_bearing": 44.0,
                          "cloud_coverage": 3.9,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T04:00:00+00:00",
                          "wind_bearing": 40.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T05:00:00+00:00",
                          "wind_bearing": 356.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T06:00:00+00:00",
                          "wind_bearing": 345.7,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T07:00:00+00:00",
                          "wind_bearing": 326.0,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 94
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T08:00:00+00:00",
                          "wind_bearing": 345.1,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 95
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T09:00:00+00:00",
                          "wind_bearing": 34.2,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.43,
                          "precipitation": 0.0,
                          "humidity": 96
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T10:00:00+00:00",
                          "wind_bearing": 345.8,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 1.12,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T11:00:00+00:00",
                          "wind_bearing": 343.2,
                          "cloud_coverage": 1.6,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.87,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T12:00:00+00:00",
                          "wind_bearing": 1.6,
                          "cloud_coverage": 7.8,
                          "uv_index": 0.4,
                          "temperature": 79,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 93
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T13:00:00+00:00",
                          "wind_bearing": 12.7,
                          "cloud_coverage": 6.2,
                          "uv_index": 1.6,
                          "temperature": 82,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 82
                        }
                      ]
                    }
                  }
                },
                "result": {
                  "params": {
                    "domain": "weather",
                    "service": "get_forecasts",
                    "service_data": {
                      "type": "hourly",
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    },
                    "target": {
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "action/1": [
              {
                "path": "action/1",
                "timestamp": "2025-08-15T13:25:30.104776+00:00"
              }
            ],
            "action/1/repeat/sequence/0": [
              {
                "path": "action/1/repeat/sequence/0",
                "timestamp": "2025-08-15T13:25:30.107277+00:00",
                "changed_variables": {
                  "repeat": {
                    "first": true,
                    "index": 1,
                    "last": true,
                    "item": "awtrix-clock/custom/jeef_weather"
                  }
                },
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "topic": "awtrix-clock/custom/jeef_weather",
                      "payload": {
                        "draw": [
                          {
                            "dp": [
                              8,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              9,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              10,
                              7,
                              "#D33F27"
                            ]
                          },
                          {
                            "dp": [
                              11,
                              7,
                              "#CC5127"
                            ]
                          },
                          {
                            "dp": [
                              12,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              13,
                              7,
                              "#C53527"
                            ]
                          },
                          {
                            "dp": [
                              14,
                              7,
                              "#C13327"
                            ]
                          },
                          {
                            "dp": [
                              15,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              16,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              17,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              18,
                              7,
                              "#EB6927"
                            ]
                          },
                          {
                            "dp": [
                              19,
                              7,
                              "#F37727"
                            ]
                          },
                          {
                            "dt": [
                              15.0,
                              1,
                              "86\u00b0",
                              "#EF7027"
                            ]
                          }
                        ],
                        "icon": "w-sunny",
                        "duration": 10,
                        "pushIcon": 2,
                        "lifetime": 120,
                        "lifetimeMode": 1,
                        "weather": "sunny"
                      }
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ],
            "action/1/repeat/sequence/1": [
              {
                "path": "action/1/repeat/sequence/1",
                "timestamp": "2025-08-15T13:25:30.115467+00:00",
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "qos": 0,
                      "retain": false,
                      "topic": "awtrix-clock/custom/jeef_weather_sun",
                      "payload": {}
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "mode": "restart",
            "variables": {
              "device_ids": [
                "a8583420298728779e89f960f8079d14"
              ],
              "app_topic": "jeef_weather",
              "topics": "{%- macro get_device_topic(device_id) %} {{ states((device_entities(device_id) | select('search','device_topic') | list)[0]) }} {%- endmacro %}\n{%- set ns = namespace(devices=[]) %} {%- for device_id in device_ids %}\n  {%- set device=get_device_topic(device_id)|replace(' ','') %}\n  {% set ns.devices = ns.devices + [ device ~ '/custom/' ~ app_topic] %}\n{%- endfor %} {{ ns.devices | reject('match','unavailable') | list}}",
              "forecast_var": "weather.forecast_home",
              "current_condition": "{{states(forecast_var)}}",
              "current_temp": "{{state_attr(forecast_var,'temperature')}}",
              "hours_to_show": 12,
              "moon": "sensor.moon_phase",
              "moon_phase": "{{states(moon)}}",
              "moon_times": "sensor.ip_geo_location",
              "moon_rise": "{{state_attr(moon_times,'moonrise')}}",
              "moon_set": "{{state_attr(moon_times,'moonset')}}",
              "moon_alt": "{{state_attr(moon_times,'moon_altitude')}}",
              "moon_risen": "{{moon_alt > 0}}",
              "when_show_moon": "night",
              "show_moon": "{%- if when_show_moon == 'always' %} True {%- elif when_show_moon == 'never' %} False {%- elif when_show_moon == 'risen' %} {{moon_risen}} {%- else %} {{state_attr('sun.sun', 'elevation') < 0 and moon_risen}} {%- endif %}",
              "message_duration": 10,
              "message_duration_riseset": 0,
              "current_temp_var": "sensor.kflwildw56_local_temperature",
              "temp_digits": 0,
              "temp_suffix": "\u00b0",
              "temp_text": "{%- macro round_and_set_temp(temp_var, temp_suffix, digits=0) -%} {%- if has_value(temp_var) -%}\n  {{ states(temp_var) | round(digits) ~ temp_suffix}} \n{%- else -%} {{current_temp ~ temp_suffix}} {%- endif -%} {%- endmacro -%} {{ round_and_set_temp(current_temp_var, temp_suffix, temp_digits)}}",
              "text_available_width": "{%- if show_moon %}16{%- else %}24{%- endif %}\n",
              "text_len": "{%- macro get_text_len(string) %} {%- set length = namespace(value=0) %} {%- for char in string %}\n  {%- if char.isdigit() %}\n    {%- set length.value = length.value + 3 %}\n  {%- elif char == '\u00b0' %}\n    {%- set length.value = length.value + 2 %}\n  {%- elif char == '.' %}\n    {%- set length.value = length.value + 1 %}\n  {%- elif char in ['-','C','F'] %}\n    {%- set length.value = length.value + 3 %}\n  {%- else %}\n    {%- set length.value = length.value + 1 %}\n  {%- endif %}\n  {%- if not loop.last %}\n    {%- set length.value = length.value + 1 %}{%- endif -%}\n{%- endfor -%} {{ length.value }} {%- endmacro %}\n{{get_text_len(temp_text)}}",
              "text_x": "{{8 + ((text_available_width - text_len)/2)}}",
              "sun_event_minute_threshold": 30,
              "sun_time_type": "Actual",
              "sun_time_format": "%-I%M%p",
              "icon_sunrise": "w-sunrise",
              "icon_sunset": "w-sunset",
              "show_sun_rise_set": false,
              "sun_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(ts_set < ts_rise,'sunset','sunrise') }}",
              "sun_min_until_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(sun_next_event == 'sunrise',(ts_rise - utcnow()|as_timestamp) / 60,(ts_set - utcnow()|as_timestamp) / 60) | round(0) }}",
              "sun_next_str": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {%- if sun_time_type == 'Actual' %}\n  {{ iif(sun_next_event == 'sunrise',(ts_rise | as_datetime | as_local).strftime(sun_time_format),  (ts_set | as_datetime | as_local).strftime(sun_time_format)) }}\n{%- else %} {#- relative time #}\n  {% set hours = sun_min_until_next_event // 60 %}\n  {% set remaining_minutes = sun_min_until_next_event % 60 %}\n\n  {% if hours == 0 %}\n      {{ remaining_minutes }} min\n  {% else %}\n      [\n        {\"t\":\"{{hours}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"h\", \"c\":\"#9c9d97\"},\n        {\"t\":\"{{remaining_minutes}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"m\", \"c\":\"#9c9d97\"}\n    ]\n  {% endif %}\n  \n{%- endif %}",
              "sun_event_icon": "{{ iif(sun_next_event == 'sunrise', icon_sunrise, icon_sunset) }}",
              "sun_event_payload": "{\"icon\":\"{{sun_event_icon}}\", \"text\":\"{{sun_next_str}}\", \"duration\": {{message_duration_riseset}}}",
              "sun_payload": "{%- if show_sun_rise_set %} {{ iif(sun_event_minute_threshold >= sun_min_until_next_event, sun_event_payload, \"{}\") }} {%- else %} {} {%- endif %}",
              "icon_clear_night": "w-clear-night",
              "use_moon_clear_night": true,
              "use_moon_sunny_night": true,
              "icon_cloudy": "w-cloudy",
              "icon_exceptional": "w-exceptional",
              "icon_fog": "w-fog",
              "icon_hail": "w-hail",
              "icon_lightning": "w-lightning",
              "icon_lightning_rainy": "w-lightning-rainy",
              "icon_partlycloudy": "w-partlycloudy",
              "icon_pouring": "w-pouring",
              "icon_rainy": "w-rainy",
              "icon_snowy": "w-snowy",
              "icon_snowy_rainy": "w-snowy-rainy",
              "icon_sunny": "w-sunny",
              "icon_windy": "w-windy",
              "icon_windy_variant": "w-windy-variant",
              "clear_night_dict": "{{ dict({\n  'full_moon': '2314',\n  'waning_gibbous': '2315',\n  'last_quarter': '2316',\n  'waning_crescent': '2317',\n  'new_moon': '2318',\n  'waxing_crescent': '2319',\n  'first_quarter': '2320',\n  'waxing_gibbous': '2321'}) }}",
              "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
              "color_dict": "{% set b = color_matrix_json | from_json %}     {%- set ns = namespace(tuples=[]) %} {%- for k,v in b | items -%}\n  {%- set key = k|float -%}\n  {%- set ns.tuples = ns.tuples + [(key,v)] %}      \n{% endfor %} {{ dict.from_keys(ns.tuples) }}",
              "icon_dict": "{{ dict({'clear-night': icon_clear_night, 'cloudy': icon_cloudy, 'exceptional': icon_exceptional, 'fog': icon_fog, 'hail': icon_hail, 'lightning': icon_lightning, 'lightning-rainy': icon_lightning_rainy, 'partlycloudy': icon_partlycloudy, 'pouring': icon_pouring, 'rainy': icon_rainy, 'snowy': icon_snowy, 'snowy-rainy': icon_snowy_rainy, 'sunny': icon_sunny, 'windy': icon_windy,  'windy-variant': icon_windy_variant})}}",
              "icon": "{%- if ((current_condition == 'clear_night') and use_moon_clear_night) %}\n  {{clear_night_dict[moon_phase]}}\n{%- elif (sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%}\n  \n{%- else %}\n  {{ icon_dict[current_condition] }}\n{%- endif %}\n",
              "moon_data": "{%- macro draw_moon(phase,x=22,y=0) %}\n  {%- if phase == 'first_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,15790320,14079702,14079702,0,3355443,3355443,3355443,3355443,13355979,13355979,14079702,14079702,3355443,3355443,1644825,3355443,13355979,15790320,15790320,14079702,3355443,3355443,1644825,3355443,15790320,15790320,15790320,14079702,3355443,3355443,3355443,3355443,15790320,13355979,14079702,14079702,0,3355443,3355443,3355443,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'full_moon'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,14079702,14079702,0,0,0,14079702,14079702,15790320,15790320,14079702,14079702,0,14079702,14079702,15790320,15790320,11974326,11974326,14079702,14079702,14079702,15790320,11974326,15790320,11974326,15790320,15790320,14079702,14079702,15790320,11974326,15790320,15790320,15790320,15790320,14079702,14079702,14079702,15790320,15790320,15790320,11974326,14079702,14079702,0,14079702,14079702,11974326,15790320,14079702,14079702,0,0,0,14079702,14079702,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'last_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3487029,3487029,0,0,0,14079702,14079702,15790320,3487029,3487029,3487029,0,14079702,14079702,15790320,15790320,1907997,1907997,3487029,3487029,14079702,15790320,13553358,15790320,1907997,3487029,3487029,3487029,14079702,15790320,13553358,15790320,3487029,3487029,3487029,3487029,14079702,14079702,15790320,15790320,3487029,1907997,3487029,3487029,0,14079702,14079702,13553358,3487029,3487029,3487029,0,0,0,14079702,14079702,3487029,3487029,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'new_moon' %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,2763306,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,2763306,2763306,0,2763306,2763306,2763306,2763306,1842204,1842204,2763306,2763306,2763306,2763306,1842204,2763306,1842204,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,0,2763306,2763306,1842204,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,2763306,2763306,0,14079702,14079702,2763306,2763306,1842204,1842204,2763306,2763306,14079702,15790320,1842204,2763306,1842204,2763306,2763306,2763306,14079702,15790320,1842204,2763306,2763306,2763306,2763306,2763306,14079702,14079702,2763306,2763306,2763306,1842204,2763306,2763306,0,14079702,14079702,1842204,2763306,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3552822,3552822,0,0,0,14079702,14079702,15790320,15790320,3552822,3552822,0,14079702,14079702,15790320,15790320,13421772,13421772,3552822,3552822,14079702,15790320,13421772,15790320,13421772,15790320,3552822,3552822,14079702,15790320,13421772,15790320,15790320,15790320,3552822,3552822,14079702,14079702,15790320,15790320,15790320,13421772,3552822,3552822,0,14079702,14079702,13421772,15790320,3552822,3552822,0,0,0,14079702,14079702,3552822,3552822,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,3355443,14079702,14079702,0,3355443,3355443,3355443,3355443,1644825,1644825,14079702,14079702,3355443,3355443,1644825,3355443,1644825,3355443,15790320,14079702,3355443,3355443,1644825,3355443,3355443,3355443,15790320,14079702,3355443,3355443,3355443,3355443,3355443,1644825,14079702,14079702,0,3355443,3355443,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,15790320,14079702,14079702,0,3355443,3355443,15790320,15790320,12763842,12763842,14079702,14079702,3355443,3355443,12763842,15790320,12763842,15790320,15790320,14079702,3355443,3355443,12763842,15790320,15790320,15790320,15790320,14079702,3355443,3355443,15790320,15790320,15790320,12763842,14079702,14079702,0,3355443,3355443,12763842,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n{%- endmacro %}\n{%- if current_condition == 'clear-night' and use_moon_clear_night -%} {{draw_moon(moon_phase,0,0)}} {%- elif(sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%} {{draw_moon(moon_phase,0,0)}} {%- else -%} {{draw_moon(moon_phase,23,0)}} {%- endif -%}\n"
            },
            "triggers": [
              {
                "platform": "time_pattern",
                "seconds": "/5"
              },
              {
                "platform": "state",
                "entity_id": "weather.forecast_home",
                "id": "Changes",
                "enabled": true
              }
            ],
            "actions": [
              {
                "target": {
                  "entity_id": "{{forecast_var}}"
                },
                "data": {
                  "type": "hourly"
                },
                "response_variable": "forecast_response",
                "action": "weather.get_forecasts"
              },
              {
                "repeat": {
                  "for_each": "{{ topics }}",
                  "sequence": [
                    {
                      "data": {
                        "topic": "{{repeat.item}}",
                        "payload": "{%- set forecast = forecast_response[forecast_var]['forecast'] -%} {%- macro interpolate(dictionary, x) -%} {%- set sorted_keys = dictionary|dictsort -%} {%- set above = sorted_keys|selectattr('0', 'gt', x)|map(attribute='0')|list|first -%} {%- set below = sorted_keys|selectattr('0', 'lt', x)|map(attribute='0')|list|last -%}\n{#- Key matches x exactly -#} {%- if above is defined and dictionary[above] == x -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{%- elif below is defined and dictionary[below] == x -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Interpolation between two values -#} {%- elif below is defined and above is defined -%}\n  {%- set lower_value = dictionary[below] -%}\n  {%- set upper_value = dictionary[above] -%}\n  {%- set lower_rgb = lower_value[1:] -%}\n  {%- set upper_rgb = upper_value[1:] -%}\n\n  {%- set lower_r = lower_rgb[0:2]|int(base=16) -%}\n  {%- set lower_g = lower_rgb[2:4]|int(base=16) -%}\n  {%- set lower_b = lower_rgb[4:6]|int(base=16) -%}\n\n  {%- set upper_r = upper_rgb[0:2]|int(base=16) -%}\n  {%- set upper_g = upper_rgb[2:4]|int(base=16) -%}\n  {%- set upper_b = upper_rgb[4:6]|int(base=16) -%}\n\n  {%- set interpolation_factor = (x - below) / (above - below) -%}\n  {%- set interpolated_r = ((1 - interpolation_factor) * lower_r + interpolation_factor * upper_r)|int -%}\n  {%- set interpolated_g = ((1 - interpolation_factor) * lower_g + interpolation_factor * upper_g)|int -%}\n  {%- set interpolated_b = ((1 - interpolation_factor) * lower_b + interpolation_factor * upper_b)|int -%}\n\n  {%- set interpolated_hex = '#' ~ '%02X' % interpolated_r ~ '%02X' % interpolated_g ~ '%02X' % interpolated_b -%}\n  {{ interpolated_hex }}\n{#- Only below key available -#} {%- elif below is defined -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Only above key available -#} {%- elif above is defined -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{#- No matching keys available -#} {%- else -%}\n  No matching key found.\n{%- endif -%} {%- endmacro -%}\n{#- Define macro to get length of the forecast -#} {%- macro str_len(stringo) %} {%- if '.' in stringo %} {%- set char_count = (stringo | length) -1 %}{{char_count * 3 + 1 + char_count}} {%- else %} {%- set char_count = (stringo | length) %}{{char_count * 3 + (char_count - 1)}} {%- endif %} {%- endmacro %}\n{#- Define a macro to draw out the forecast lines#}\n  {%- macro draw_forecast_lines(x,hours,height) %}\n    {%- for hour in range(hours) %}\n      {%- if height == 0 %}\n        {\"dp\": [{{x+hour}},7,\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- else %}\n        {\"dl\": [{{x+hour}},7,{{x+hour}},{{7 - height}},\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- endif %}\n      {%- if hour+1 != hours %},{%endif%}\n    {%- endfor %}\n  {%- endmacro %}\n\n  {\n    \"draw\": [\n      {%- if hours_to_show > 0 %}\n      {{draw_forecast_lines(8,hours_to_show,0)}}\n    {%- endif %}\n    {%- if current_temp != 'unavailable' -%}\n    ,{\"dt\":[{{text_x}},1,\"{{temp_text}}\",\"{{interpolate(color_dict, current_temp | float)}}\"]}\n    {%- else -%}\n    {\"dt\":\"err\"}\n    {%- endif -%}\n\n    {% if show_moon %}\n    ,{{moon_data}}\n    {% endif %}\n    ],\n    \"icon\": \"{{icon}}\",\n    \"duration\": {{message_duration}},\n    \"pushIcon\": 2,\n    \"lifetime\": 120,\n    \"lifetimeMode\":1,\n    \"weather\": \"{{current_condition}}\"\n    }"
                      },
                      "action": "mqtt.publish"
                    },
                    {
                      "data": {
                        "qos": 0,
                        "retain": false,
                        "topic": "{{ repeat.item ~ '_sun'}} ",
                        "payload": "{{sun_payload}}\n"
                      },
                      "action": "mqtt.publish"
                    }
                  ]
                }
              }
            ],
            "conditions": [],
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather"
          },
          "blueprint_inputs": {
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather",
            "use_blueprint": {
              "path": "jeeftor/awtrix_weatherflow.yaml",
              "input": {
                "awtrix": [
                  "a8583420298728779e89f960f8079d14"
                ],
                "forecast_var": "weather.forecast_home",
                "forecast_temp_field": "temperature",
                "temp_suffix": "\u00b0",
                "current_temp_var": "sensor.kflwildw56_local_temperature",
                "moon": "sensor.moon_phase",
                "moon_rise_set": "sensor.ip_geo_location",
                "show_sun_rise_set": false,
                "message_duration_riseset": 0,
                "message_duration_forecast": 10,
                "hours_to_show": 12,
                "temp_digits": 0
              }
            }
          },
          "context": {
            "id": "01K2PYGABEVTHWS9KM2PC8GTZ2",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "0fe595a8d1d61d7188a7ef9292922ba4",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:30.094547+00:00",
            "finish": "2025-08-15T13:25:30.119300+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern"
        }
      },
      {
        "extended_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "3233672eff8b0870f2c9f34533bce6a2",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:35.094499+00:00",
            "finish": "2025-08-15T13:25:35.114803+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern",
          "trace": {
            "trigger/0": [
              {
                "path": "trigger/0",
                "timestamp": "2025-08-15T13:25:35.104171+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.awtrix_mega_weather",
                    "state": "on",
                    "attributes": {
                      "id": "1710004236293",
                      "last_triggered": "2025-08-15T13:25:30.099970+00:00",
                      "mode": "restart",
                      "current": 0,
                      "friendly_name": "awtrix_mega_weather",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.874702+00:00",
                    "last_reported": "2025-08-15T13:25:30.118695+00:00",
                    "last_updated": "2025-08-15T13:25:30.118695+00:00",
                    "context": {
                      "id": "01K2PYGABEVTHWS9KM2PC8GTZ2",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "0",
                    "idx": "0",
                    "alias": null,
                    "platform": "time_pattern",
                    "now": "2025-08-15T09:25:35.094286-04:00",
                    "description": "time pattern"
                  },
                  "device_ids": [
                    "a8583420298728779e89f960f8079d14"
                  ],
                  "app_topic": "jeef_weather",
                  "topics": [
                    "awtrix-clock/custom/jeef_weather"
                  ],
                  "forecast_var": "weather.forecast_home",
                  "current_condition": "sunny",
                  "current_temp": 82,
                  "hours_to_show": 12,
                  "moon": "sensor.moon_phase",
                  "moon_phase": "waning_gibbous",
                  "moon_times": "sensor.ip_geo_location",
                  "moon_rise": "-:-",
                  "moon_set": "13:31",
                  "moon_alt": 50.388162613986886,
                  "moon_risen": true,
                  "when_show_moon": "night",
                  "show_moon": false,
                  "message_duration": 10,
                  "message_duration_riseset": 0,
                  "current_temp_var": "sensor.kflwildw56_local_temperature",
                  "temp_digits": 0,
                  "temp_suffix": "\u00b0",
                  "temp_text": "86\u00b0",
                  "text_available_width": 24,
                  "text_len": 10,
                  "text_x": 15.0,
                  "sun_event_minute_threshold": 30,
                  "sun_time_type": "Actual",
                  "sun_time_format": "%-I%M%p",
                  "icon_sunrise": "w-sunrise",
                  "icon_sunset": "w-sunset",
                  "show_sun_rise_set": false,
                  "sun_next_event": "sunset",
                  "sun_min_until_next_event": 642,
                  "sun_next_str": "807PM",
                  "sun_event_icon": "w-sunset",
                  "sun_event_payload": {
                    "icon": "w-sunset",
                    "text": "807PM",
                    "duration": 0
                  },
                  "sun_payload": {},
                  "icon_clear_night": "w-clear-night",
                  "use_moon_clear_night": true,
                  "use_moon_sunny_night": true,
                  "icon_cloudy": "w-cloudy",
                  "icon_exceptional": "w-exceptional",
                  "icon_fog": "w-fog",
                  "icon_hail": "w-hail",
                  "icon_lightning": "w-lightning",
                  "icon_lightning_rainy": "w-lightning-rainy",
                  "icon_partlycloudy": "w-partlycloudy",
                  "icon_pouring": "w-pouring",
                  "icon_rainy": "w-rainy",
                  "icon_snowy": "w-snowy",
                  "icon_snowy_rainy": "w-snowy-rainy",
                  "icon_sunny": "w-sunny",
                  "icon_windy": "w-windy",
                  "icon_windy_variant": "w-windy-variant",
                  "clear_night_dict": {
                    "full_moon": "2314",
                    "waning_gibbous": "2315",
                    "last_quarter": "2316",
                    "waning_crescent": "2317",
                    "new_moon": "2318",
                    "waxing_crescent": "2319",
                    "first_quarter": "2320",
                    "waxing_gibbous": "2321"
                  },
                  "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
                  "color_dict": {
                    "0.0": "#FEC4FF",
                    "10.0": "#D977DF",
                    "20.0": "#9545BC",
                    "30.0": "#4B379C",
                    "40.0": "#31B8DB",
                    "50.0": "#31DB8B",
                    "60.0": "#6ED228",
                    "70.0": "#FFFF28",
                    "80.0": "#F87E27",
                    "90.0": "#CF3927",
                    "100.0": "#A12527"
                  },
                  "icon_dict": {
                    "clear-night": "w-clear-night",
                    "cloudy": "w-cloudy",
                    "exceptional": "w-exceptional",
                    "fog": "w-fog",
                    "hail": "w-hail",
                    "lightning": "w-lightning",
                    "lightning-rainy": "w-lightning-rainy",
                    "partlycloudy": "w-partlycloudy",
                    "pouring": "w-pouring",
                    "rainy": "w-rainy",
                    "snowy": "w-snowy",
                    "snowy-rainy": "w-snowy-rainy",
                    "sunny": "w-sunny",
                    "windy": "w-windy",
                    "windy-variant": "w-windy-variant"
                  },
                  "icon": "w-sunny",
                  "moon_data": {
                    "db": [
                      23,
                      0,
                      8,
                      8,
                      [
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        13421772,
                        13421772,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        15790320,
                        13421772,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0
                      ]
                    ]
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:25:35.104496+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYGF7P9KHVH25J7V1FECTV",
                    "parent_id": null,
                    "user_id": null
                  },
                  "forecast_response": {
                    "weather.forecast_home": {
                      "forecast": [
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T14:00:00+00:00",
                          "wind_bearing": 348.6,
                          "cloud_coverage": 7.0,
                          "uv_index": 3.9,
                          "temperature": 85,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 81
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T15:00:00+00:00",
                          "wind_bearing": 355.2,
                          "cloud_coverage": 18.7,
                          "uv_index": 6.6,
                          "temperature": 87,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 72
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T16:00:00+00:00",
                          "wind_bearing": 349.3,
                          "cloud_coverage": 21.1,
                          "uv_index": 9.1,
                          "temperature": 89,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 65
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T17:00:00+00:00",
                          "wind_bearing": 310.7,
                          "cloud_coverage": 18.0,
                          "uv_index": 10.5,
                          "temperature": 90,
                          "wind_speed": 2.67,
                          "precipitation": 0.0,
                          "humidity": 60
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T18:00:00+00:00",
                          "wind_bearing": 289.1,
                          "cloud_coverage": 12.5,
                          "uv_index": 10.4,
                          "temperature": 91,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 58
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T19:00:00+00:00",
                          "wind_bearing": 289.6,
                          "cloud_coverage": 12.5,
                          "uv_index": 8.7,
                          "temperature": 92,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 56
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T20:00:00+00:00",
                          "wind_bearing": 321.5,
                          "cloud_coverage": 10.9,
                          "uv_index": 6.1,
                          "temperature": 93,
                          "wind_speed": 3.6,
                          "precipitation": 0.01,
                          "humidity": 55
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T21:00:00+00:00",
                          "wind_bearing": 285.4,
                          "cloud_coverage": 58.6,
                          "uv_index": 3.4,
                          "temperature": 91,
                          "wind_speed": 7.83,
                          "precipitation": 0.02,
                          "humidity": 59
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T22:00:00+00:00",
                          "wind_bearing": 276.0,
                          "cloud_coverage": 78.9,
                          "uv_index": 1.4,
                          "temperature": 87,
                          "wind_speed": 6.71,
                          "precipitation": 0.0,
                          "humidity": 69
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T23:00:00+00:00",
                          "wind_bearing": 23.2,
                          "cloud_coverage": 61.7,
                          "uv_index": 0.3,
                          "temperature": 85,
                          "wind_speed": 5.59,
                          "precipitation": 0.0,
                          "humidity": 73
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T00:00:00+00:00",
                          "wind_bearing": 51.4,
                          "cloud_coverage": 30.5,
                          "uv_index": 0.0,
                          "temperature": 83,
                          "wind_speed": 4.23,
                          "precipitation": 0.0,
                          "humidity": 80
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T01:00:00+00:00",
                          "wind_bearing": 45.3,
                          "cloud_coverage": 33.6,
                          "uv_index": 0.0,
                          "temperature": 81,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 84
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T02:00:00+00:00",
                          "wind_bearing": 32.7,
                          "cloud_coverage": 17.2,
                          "uv_index": 0.0,
                          "temperature": 80,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 87
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T03:00:00+00:00",
                          "wind_bearing": 44.0,
                          "cloud_coverage": 3.9,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T04:00:00+00:00",
                          "wind_bearing": 40.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T05:00:00+00:00",
                          "wind_bearing": 356.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T06:00:00+00:00",
                          "wind_bearing": 345.7,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T07:00:00+00:00",
                          "wind_bearing": 326.0,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 94
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T08:00:00+00:00",
                          "wind_bearing": 345.1,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 95
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T09:00:00+00:00",
                          "wind_bearing": 34.2,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.43,
                          "precipitation": 0.0,
                          "humidity": 96
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T10:00:00+00:00",
                          "wind_bearing": 345.8,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 1.12,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T11:00:00+00:00",
                          "wind_bearing": 343.2,
                          "cloud_coverage": 1.6,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.87,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T12:00:00+00:00",
                          "wind_bearing": 1.6,
                          "cloud_coverage": 7.8,
                          "uv_index": 0.4,
                          "temperature": 79,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 93
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T13:00:00+00:00",
                          "wind_bearing": 12.7,
                          "cloud_coverage": 6.2,
                          "uv_index": 1.6,
                          "temperature": 82,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 82
                        }
                      ]
                    }
                  }
                },
                "result": {
                  "params": {
                    "domain": "weather",
                    "service": "get_forecasts",
                    "service_data": {
                      "type": "hourly",
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    },
                    "target": {
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "action/1": [
              {
                "path": "action/1",
                "timestamp": "2025-08-15T13:25:35.105660+00:00"
              }
            ],
            "action/1/repeat/sequence/0": [
              {
                "path": "action/1/repeat/sequence/0",
                "timestamp": "2025-08-15T13:25:35.106351+00:00",
                "changed_variables": {
                  "repeat": {
                    "first": true,
                    "index": 1,
                    "last": true,
                    "item": "awtrix-clock/custom/jeef_weather"
                  }
                },
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "topic": "awtrix-clock/custom/jeef_weather",
                      "payload": {
                        "draw": [
                          {
                            "dp": [
                              8,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              9,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              10,
                              7,
                              "#D33F27"
                            ]
                          },
                          {
                            "dp": [
                              11,
                              7,
                              "#CC5127"
                            ]
                          },
                          {
                            "dp": [
                              12,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              13,
                              7,
                              "#C53527"
                            ]
                          },
                          {
                            "dp": [
                              14,
                              7,
                              "#C13327"
                            ]
                          },
                          {
                            "dp": [
                              15,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              16,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              17,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              18,
                              7,
                              "#EB6927"
                            ]
                          },
                          {
                            "dp": [
                              19,
                              7,
                              "#F37727"
                            ]
                          },
                          {
                            "dt": [
                              15.0,
                              1,
                              "86\u00b0",
                              "#EF7027"
                            ]
                          }
                        ],
                        "icon": "w-sunny",
                        "duration": 10,
                        "pushIcon": 2,
                        "lifetime": 120,
                        "lifetimeMode": 1,
                        "weather": "sunny"
                      }
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ],
            "action/1/repeat/sequence/1": [
              {
                "path": "action/1/repeat/sequence/1",
                "timestamp": "2025-08-15T13:25:35.111960+00:00",
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "qos": 0,
                      "retain": false,
                      "topic": "awtrix-clock/custom/jeef_weather_sun",
                      "payload": {}
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "mode": "restart",
            "variables": {
              "device_ids": [
                "a8583420298728779e89f960f8079d14"
              ],
              "app_topic": "jeef_weather",
              "topics": "{%- macro get_device_topic(device_id) %} {{ states((device_entities(device_id) | select('search','device_topic') | list)[0]) }} {%- endmacro %}\n{%- set ns = namespace(devices=[]) %} {%- for device_id in device_ids %}\n  {%- set device=get_device_topic(device_id)|replace(' ','') %}\n  {% set ns.devices = ns.devices + [ device ~ '/custom/' ~ app_topic] %}\n{%- endfor %} {{ ns.devices | reject('match','unavailable') | list}}",
              "forecast_var": "weather.forecast_home",
              "current_condition": "{{states(forecast_var)}}",
              "current_temp": "{{state_attr(forecast_var,'temperature')}}",
              "hours_to_show": 12,
              "moon": "sensor.moon_phase",
              "moon_phase": "{{states(moon)}}",
              "moon_times": "sensor.ip_geo_location",
              "moon_rise": "{{state_attr(moon_times,'moonrise')}}",
              "moon_set": "{{state_attr(moon_times,'moonset')}}",
              "moon_alt": "{{state_attr(moon_times,'moon_altitude')}}",
              "moon_risen": "{{moon_alt > 0}}",
              "when_show_moon": "night",
              "show_moon": "{%- if when_show_moon == 'always' %} True {%- elif when_show_moon == 'never' %} False {%- elif when_show_moon == 'risen' %} {{moon_risen}} {%- else %} {{state_attr('sun.sun', 'elevation') < 0 and moon_risen}} {%- endif %}",
              "message_duration": 10,
              "message_duration_riseset": 0,
              "current_temp_var": "sensor.kflwildw56_local_temperature",
              "temp_digits": 0,
              "temp_suffix": "\u00b0",
              "temp_text": "{%- macro round_and_set_temp(temp_var, temp_suffix, digits=0) -%} {%- if has_value(temp_var) -%}\n  {{ states(temp_var) | round(digits) ~ temp_suffix}} \n{%- else -%} {{current_temp ~ temp_suffix}} {%- endif -%} {%- endmacro -%} {{ round_and_set_temp(current_temp_var, temp_suffix, temp_digits)}}",
              "text_available_width": "{%- if show_moon %}16{%- else %}24{%- endif %}\n",
              "text_len": "{%- macro get_text_len(string) %} {%- set length = namespace(value=0) %} {%- for char in string %}\n  {%- if char.isdigit() %}\n    {%- set length.value = length.value + 3 %}\n  {%- elif char == '\u00b0' %}\n    {%- set length.value = length.value + 2 %}\n  {%- elif char == '.' %}\n    {%- set length.value = length.value + 1 %}\n  {%- elif char in ['-','C','F'] %}\n    {%- set length.value = length.value + 3 %}\n  {%- else %}\n    {%- set length.value = length.value + 1 %}\n  {%- endif %}\n  {%- if not loop.last %}\n    {%- set length.value = length.value + 1 %}{%- endif -%}\n{%- endfor -%} {{ length.value }} {%- endmacro %}\n{{get_text_len(temp_text)}}",
              "text_x": "{{8 + ((text_available_width - text_len)/2)}}",
              "sun_event_minute_threshold": 30,
              "sun_time_type": "Actual",
              "sun_time_format": "%-I%M%p",
              "icon_sunrise": "w-sunrise",
              "icon_sunset": "w-sunset",
              "show_sun_rise_set": false,
              "sun_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(ts_set < ts_rise,'sunset','sunrise') }}",
              "sun_min_until_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(sun_next_event == 'sunrise',(ts_rise - utcnow()|as_timestamp) / 60,(ts_set - utcnow()|as_timestamp) / 60) | round(0) }}",
              "sun_next_str": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {%- if sun_time_type == 'Actual' %}\n  {{ iif(sun_next_event == 'sunrise',(ts_rise | as_datetime | as_local).strftime(sun_time_format),  (ts_set | as_datetime | as_local).strftime(sun_time_format)) }}\n{%- else %} {#- relative time #}\n  {% set hours = sun_min_until_next_event // 60 %}\n  {% set remaining_minutes = sun_min_until_next_event % 60 %}\n\n  {% if hours == 0 %}\n      {{ remaining_minutes }} min\n  {% else %}\n      [\n        {\"t\":\"{{hours}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"h\", \"c\":\"#9c9d97\"},\n        {\"t\":\"{{remaining_minutes}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"m\", \"c\":\"#9c9d97\"}\n    ]\n  {% endif %}\n  \n{%- endif %}",
              "sun_event_icon": "{{ iif(sun_next_event == 'sunrise', icon_sunrise, icon_sunset) }}",
              "sun_event_payload": "{\"icon\":\"{{sun_event_icon}}\", \"text\":\"{{sun_next_str}}\", \"duration\": {{message_duration_riseset}}}",
              "sun_payload": "{%- if show_sun_rise_set %} {{ iif(sun_event_minute_threshold >= sun_min_until_next_event, sun_event_payload, \"{}\") }} {%- else %} {} {%- endif %}",
              "icon_clear_night": "w-clear-night",
              "use_moon_clear_night": true,
              "use_moon_sunny_night": true,
              "icon_cloudy": "w-cloudy",
              "icon_exceptional": "w-exceptional",
              "icon_fog": "w-fog",
              "icon_hail": "w-hail",
              "icon_lightning": "w-lightning",
              "icon_lightning_rainy": "w-lightning-rainy",
              "icon_partlycloudy": "w-partlycloudy",
              "icon_pouring": "w-pouring",
              "icon_rainy": "w-rainy",
              "icon_snowy": "w-snowy",
              "icon_snowy_rainy": "w-snowy-rainy",
              "icon_sunny": "w-sunny",
              "icon_windy": "w-windy",
              "icon_windy_variant": "w-windy-variant",
              "clear_night_dict": "{{ dict({\n  'full_moon': '2314',\n  'waning_gibbous': '2315',\n  'last_quarter': '2316',\n  'waning_crescent': '2317',\n  'new_moon': '2318',\n  'waxing_crescent': '2319',\n  'first_quarter': '2320',\n  'waxing_gibbous': '2321'}) }}",
              "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
              "color_dict": "{% set b = color_matrix_json | from_json %}     {%- set ns = namespace(tuples=[]) %} {%- for k,v in b | items -%}\n  {%- set key = k|float -%}\n  {%- set ns.tuples = ns.tuples + [(key,v)] %}      \n{% endfor %} {{ dict.from_keys(ns.tuples) }}",
              "icon_dict": "{{ dict({'clear-night': icon_clear_night, 'cloudy': icon_cloudy, 'exceptional': icon_exceptional, 'fog': icon_fog, 'hail': icon_hail, 'lightning': icon_lightning, 'lightning-rainy': icon_lightning_rainy, 'partlycloudy': icon_partlycloudy, 'pouring': icon_pouring, 'rainy': icon_rainy, 'snowy': icon_snowy, 'snowy-rainy': icon_snowy_rainy, 'sunny': icon_sunny, 'windy': icon_windy,  'windy-variant': icon_windy_variant})}}",
              "icon": "{%- if ((current_condition == 'clear_night') and use_moon_clear_night) %}\n  {{clear_night_dict[moon_phase]}}\n{%- elif (sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%}\n  \n{%- else %}\n  {{ icon_dict[current_condition] }}\n{%- endif %}\n",
              "moon_data": "{%- macro draw_moon(phase,x=22,y=0) %}\n  {%- if phase == 'first_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,15790320,14079702,14079702,0,3355443,3355443,3355443,3355443,13355979,13355979,14079702,14079702,3355443,3355443,1644825,3355443,13355979,15790320,15790320,14079702,3355443,3355443,1644825,3355443,15790320,15790320,15790320,14079702,3355443,3355443,3355443,3355443,15790320,13355979,14079702,14079702,0,3355443,3355443,3355443,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'full_moon'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,14079702,14079702,0,0,0,14079702,14079702,15790320,15790320,14079702,14079702,0,14079702,14079702,15790320,15790320,11974326,11974326,14079702,14079702,14079702,15790320,11974326,15790320,11974326,15790320,15790320,14079702,14079702,15790320,11974326,15790320,15790320,15790320,15790320,14079702,14079702,14079702,15790320,15790320,15790320,11974326,14079702,14079702,0,14079702,14079702,11974326,15790320,14079702,14079702,0,0,0,14079702,14079702,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'last_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3487029,3487029,0,0,0,14079702,14079702,15790320,3487029,3487029,3487029,0,14079702,14079702,15790320,15790320,1907997,1907997,3487029,3487029,14079702,15790320,13553358,15790320,1907997,3487029,3487029,3487029,14079702,15790320,13553358,15790320,3487029,3487029,3487029,3487029,14079702,14079702,15790320,15790320,3487029,1907997,3487029,3487029,0,14079702,14079702,13553358,3487029,3487029,3487029,0,0,0,14079702,14079702,3487029,3487029,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'new_moon' %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,2763306,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,2763306,2763306,0,2763306,2763306,2763306,2763306,1842204,1842204,2763306,2763306,2763306,2763306,1842204,2763306,1842204,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,0,2763306,2763306,1842204,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,2763306,2763306,0,14079702,14079702,2763306,2763306,1842204,1842204,2763306,2763306,14079702,15790320,1842204,2763306,1842204,2763306,2763306,2763306,14079702,15790320,1842204,2763306,2763306,2763306,2763306,2763306,14079702,14079702,2763306,2763306,2763306,1842204,2763306,2763306,0,14079702,14079702,1842204,2763306,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3552822,3552822,0,0,0,14079702,14079702,15790320,15790320,3552822,3552822,0,14079702,14079702,15790320,15790320,13421772,13421772,3552822,3552822,14079702,15790320,13421772,15790320,13421772,15790320,3552822,3552822,14079702,15790320,13421772,15790320,15790320,15790320,3552822,3552822,14079702,14079702,15790320,15790320,15790320,13421772,3552822,3552822,0,14079702,14079702,13421772,15790320,3552822,3552822,0,0,0,14079702,14079702,3552822,3552822,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,3355443,14079702,14079702,0,3355443,3355443,3355443,3355443,1644825,1644825,14079702,14079702,3355443,3355443,1644825,3355443,1644825,3355443,15790320,14079702,3355443,3355443,1644825,3355443,3355443,3355443,15790320,14079702,3355443,3355443,3355443,3355443,3355443,1644825,14079702,14079702,0,3355443,3355443,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,15790320,14079702,14079702,0,3355443,3355443,15790320,15790320,12763842,12763842,14079702,14079702,3355443,3355443,12763842,15790320,12763842,15790320,15790320,14079702,3355443,3355443,12763842,15790320,15790320,15790320,15790320,14079702,3355443,3355443,15790320,15790320,15790320,12763842,14079702,14079702,0,3355443,3355443,12763842,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n{%- endmacro %}\n{%- if current_condition == 'clear-night' and use_moon_clear_night -%} {{draw_moon(moon_phase,0,0)}} {%- elif(sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%} {{draw_moon(moon_phase,0,0)}} {%- else -%} {{draw_moon(moon_phase,23,0)}} {%- endif -%}\n"
            },
            "triggers": [
              {
                "platform": "time_pattern",
                "seconds": "/5"
              },
              {
                "platform": "state",
                "entity_id": "weather.forecast_home",
                "id": "Changes",
                "enabled": true
              }
            ],
            "actions": [
              {
                "target": {
                  "entity_id": "{{forecast_var}}"
                },
                "data": {
                  "type": "hourly"
                },
                "response_variable": "forecast_response",
                "action": "weather.get_forecasts"
              },
              {
                "repeat": {
                  "for_each": "{{ topics }}",
                  "sequence": [
                    {
                      "data": {
                        "topic": "{{repeat.item}}",
                        "payload": "{%- set forecast = forecast_response[forecast_var]['forecast'] -%} {%- macro interpolate(dictionary, x) -%} {%- set sorted_keys = dictionary|dictsort -%} {%- set above = sorted_keys|selectattr('0', 'gt', x)|map(attribute='0')|list|first -%} {%- set below = sorted_keys|selectattr('0', 'lt', x)|map(attribute='0')|list|last -%}\n{#- Key matches x exactly -#} {%- if above is defined and dictionary[above] == x -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{%- elif below is defined and dictionary[below] == x -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Interpolation between two values -#} {%- elif below is defined and above is defined -%}\n  {%- set lower_value = dictionary[below] -%}\n  {%- set upper_value = dictionary[above] -%}\n  {%- set lower_rgb = lower_value[1:] -%}\n  {%- set upper_rgb = upper_value[1:] -%}\n\n  {%- set lower_r = lower_rgb[0:2]|int(base=16) -%}\n  {%- set lower_g = lower_rgb[2:4]|int(base=16) -%}\n  {%- set lower_b = lower_rgb[4:6]|int(base=16) -%}\n\n  {%- set upper_r = upper_rgb[0:2]|int(base=16) -%}\n  {%- set upper_g = upper_rgb[2:4]|int(base=16) -%}\n  {%- set upper_b = upper_rgb[4:6]|int(base=16) -%}\n\n  {%- set interpolation_factor = (x - below) / (above - below) -%}\n  {%- set interpolated_r = ((1 - interpolation_factor) * lower_r + interpolation_factor * upper_r)|int -%}\n  {%- set interpolated_g = ((1 - interpolation_factor) * lower_g + interpolation_factor * upper_g)|int -%}\n  {%- set interpolated_b = ((1 - interpolation_factor) * lower_b + interpolation_factor * upper_b)|int -%}\n\n  {%- set interpolated_hex = '#' ~ '%02X' % interpolated_r ~ '%02X' % interpolated_g ~ '%02X' % interpolated_b -%}\n  {{ interpolated_hex }}\n{#- Only below key available -#} {%- elif below is defined -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Only above key available -#} {%- elif above is defined -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{#- No matching keys available -#} {%- else -%}\n  No matching key found.\n{%- endif -%} {%- endmacro -%}\n{#- Define macro to get length of the forecast -#} {%- macro str_len(stringo) %} {%- if '.' in stringo %} {%- set char_count = (stringo | length) -1 %}{{char_count * 3 + 1 + char_count}} {%- else %} {%- set char_count = (stringo | length) %}{{char_count * 3 + (char_count - 1)}} {%- endif %} {%- endmacro %}\n{#- Define a macro to draw out the forecast lines#}\n  {%- macro draw_forecast_lines(x,hours,height) %}\n    {%- for hour in range(hours) %}\n      {%- if height == 0 %}\n        {\"dp\": [{{x+hour}},7,\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- else %}\n        {\"dl\": [{{x+hour}},7,{{x+hour}},{{7 - height}},\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- endif %}\n      {%- if hour+1 != hours %},{%endif%}\n    {%- endfor %}\n  {%- endmacro %}\n\n  {\n    \"draw\": [\n      {%- if hours_to_show > 0 %}\n      {{draw_forecast_lines(8,hours_to_show,0)}}\n    {%- endif %}\n    {%- if current_temp != 'unavailable' -%}\n    ,{\"dt\":[{{text_x}},1,\"{{temp_text}}\",\"{{interpolate(color_dict, current_temp | float)}}\"]}\n    {%- else -%}\n    {\"dt\":\"err\"}\n    {%- endif -%}\n\n    {% if show_moon %}\n    ,{{moon_data}}\n    {% endif %}\n    ],\n    \"icon\": \"{{icon}}\",\n    \"duration\": {{message_duration}},\n    \"pushIcon\": 2,\n    \"lifetime\": 120,\n    \"lifetimeMode\":1,\n    \"weather\": \"{{current_condition}}\"\n    }"
                      },
                      "action": "mqtt.publish"
                    },
                    {
                      "data": {
                        "qos": 0,
                        "retain": false,
                        "topic": "{{ repeat.item ~ '_sun'}} ",
                        "payload": "{{sun_payload}}\n"
                      },
                      "action": "mqtt.publish"
                    }
                  ]
                }
              }
            ],
            "conditions": [],
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather"
          },
          "blueprint_inputs": {
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather",
            "use_blueprint": {
              "path": "jeeftor/awtrix_weatherflow.yaml",
              "input": {
                "awtrix": [
                  "a8583420298728779e89f960f8079d14"
                ],
                "forecast_var": "weather.forecast_home",
                "forecast_temp_field": "temperature",
                "temp_suffix": "\u00b0",
                "current_temp_var": "sensor.kflwildw56_local_temperature",
                "moon": "sensor.moon_phase",
                "moon_rise_set": "sensor.ip_geo_location",
                "show_sun_rise_set": false,
                "message_duration_riseset": 0,
                "message_duration_forecast": 10,
                "hours_to_show": 12,
                "temp_digits": 0
              }
            }
          },
          "context": {
            "id": "01K2PYGF7P9KHVH25J7V1FECTV",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "3233672eff8b0870f2c9f34533bce6a2",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:35.094499+00:00",
            "finish": "2025-08-15T13:25:35.114803+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern"
        }
      },
      {
        "extended_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "9c1e83ab73484c2ff449b898703eeb70",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:40.094207+00:00",
            "finish": "2025-08-15T13:25:40.118841+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern",
          "trace": {
            "trigger/0": [
              {
                "path": "trigger/0",
                "timestamp": "2025-08-15T13:25:40.099825+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.awtrix_mega_weather",
                    "state": "on",
                    "attributes": {
                      "id": "1710004236293",
                      "last_triggered": "2025-08-15T13:25:35.104306+00:00",
                      "mode": "restart",
                      "current": 0,
                      "friendly_name": "awtrix_mega_weather",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.874702+00:00",
                    "last_reported": "2025-08-15T13:25:35.114435+00:00",
                    "last_updated": "2025-08-15T13:25:35.114435+00:00",
                    "context": {
                      "id": "01K2PYGF7P9KHVH25J7V1FECTV",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "0",
                    "idx": "0",
                    "alias": null,
                    "platform": "time_pattern",
                    "now": "2025-08-15T09:25:40.093972-04:00",
                    "description": "time pattern"
                  },
                  "device_ids": [
                    "a8583420298728779e89f960f8079d14"
                  ],
                  "app_topic": "jeef_weather",
                  "topics": [
                    "awtrix-clock/custom/jeef_weather"
                  ],
                  "forecast_var": "weather.forecast_home",
                  "current_condition": "sunny",
                  "current_temp": 82,
                  "hours_to_show": 12,
                  "moon": "sensor.moon_phase",
                  "moon_phase": "waning_gibbous",
                  "moon_times": "sensor.ip_geo_location",
                  "moon_rise": "-:-",
                  "moon_set": "13:31",
                  "moon_alt": 50.388162613986886,
                  "moon_risen": true,
                  "when_show_moon": "night",
                  "show_moon": false,
                  "message_duration": 10,
                  "message_duration_riseset": 0,
                  "current_temp_var": "sensor.kflwildw56_local_temperature",
                  "temp_digits": 0,
                  "temp_suffix": "\u00b0",
                  "temp_text": "86\u00b0",
                  "text_available_width": 24,
                  "text_len": 10,
                  "text_x": 15.0,
                  "sun_event_minute_threshold": 30,
                  "sun_time_type": "Actual",
                  "sun_time_format": "%-I%M%p",
                  "icon_sunrise": "w-sunrise",
                  "icon_sunset": "w-sunset",
                  "show_sun_rise_set": false,
                  "sun_next_event": "sunset",
                  "sun_min_until_next_event": 642,
                  "sun_next_str": "807PM",
                  "sun_event_icon": "w-sunset",
                  "sun_event_payload": {
                    "icon": "w-sunset",
                    "text": "807PM",
                    "duration": 0
                  },
                  "sun_payload": {},
                  "icon_clear_night": "w-clear-night",
                  "use_moon_clear_night": true,
                  "use_moon_sunny_night": true,
                  "icon_cloudy": "w-cloudy",
                  "icon_exceptional": "w-exceptional",
                  "icon_fog": "w-fog",
                  "icon_hail": "w-hail",
                  "icon_lightning": "w-lightning",
                  "icon_lightning_rainy": "w-lightning-rainy",
                  "icon_partlycloudy": "w-partlycloudy",
                  "icon_pouring": "w-pouring",
                  "icon_rainy": "w-rainy",
                  "icon_snowy": "w-snowy",
                  "icon_snowy_rainy": "w-snowy-rainy",
                  "icon_sunny": "w-sunny",
                  "icon_windy": "w-windy",
                  "icon_windy_variant": "w-windy-variant",
                  "clear_night_dict": {
                    "full_moon": "2314",
                    "waning_gibbous": "2315",
                    "last_quarter": "2316",
                    "waning_crescent": "2317",
                    "new_moon": "2318",
                    "waxing_crescent": "2319",
                    "first_quarter": "2320",
                    "waxing_gibbous": "2321"
                  },
                  "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
                  "color_dict": {
                    "0.0": "#FEC4FF",
                    "10.0": "#D977DF",
                    "20.0": "#9545BC",
                    "30.0": "#4B379C",
                    "40.0": "#31B8DB",
                    "50.0": "#31DB8B",
                    "60.0": "#6ED228",
                    "70.0": "#FFFF28",
                    "80.0": "#F87E27",
                    "90.0": "#CF3927",
                    "100.0": "#A12527"
                  },
                  "icon_dict": {
                    "clear-night": "w-clear-night",
                    "cloudy": "w-cloudy",
                    "exceptional": "w-exceptional",
                    "fog": "w-fog",
                    "hail": "w-hail",
                    "lightning": "w-lightning",
                    "lightning-rainy": "w-lightning-rainy",
                    "partlycloudy": "w-partlycloudy",
                    "pouring": "w-pouring",
                    "rainy": "w-rainy",
                    "snowy": "w-snowy",
                    "snowy-rainy": "w-snowy-rainy",
                    "sunny": "w-sunny",
                    "windy": "w-windy",
                    "windy-variant": "w-windy-variant"
                  },
                  "icon": "w-sunny",
                  "moon_data": {
                    "db": [
                      23,
                      0,
                      8,
                      8,
                      [
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        13421772,
                        13421772,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        15790320,
                        13421772,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0
                      ]
                    ]
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:25:40.100470+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYGM3Y8AGR8ZGRHWRRHM5T",
                    "parent_id": null,
                    "user_id": null
                  },
                  "forecast_response": {
                    "weather.forecast_home": {
                      "forecast": [
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T14:00:00+00:00",
                          "wind_bearing": 348.6,
                          "cloud_coverage": 7.0,
                          "uv_index": 3.9,
                          "temperature": 85,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 81
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T15:00:00+00:00",
                          "wind_bearing": 355.2,
                          "cloud_coverage": 18.7,
                          "uv_index": 6.6,
                          "temperature": 87,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 72
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T16:00:00+00:00",
                          "wind_bearing": 349.3,
                          "cloud_coverage": 21.1,
                          "uv_index": 9.1,
                          "temperature": 89,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 65
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T17:00:00+00:00",
                          "wind_bearing": 310.7,
                          "cloud_coverage": 18.0,
                          "uv_index": 10.5,
                          "temperature": 90,
                          "wind_speed": 2.67,
                          "precipitation": 0.0,
                          "humidity": 60
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T18:00:00+00:00",
                          "wind_bearing": 289.1,
                          "cloud_coverage": 12.5,
                          "uv_index": 10.4,
                          "temperature": 91,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 58
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T19:00:00+00:00",
                          "wind_bearing": 289.6,
                          "cloud_coverage": 12.5,
                          "uv_index": 8.7,
                          "temperature": 92,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 56
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T20:00:00+00:00",
                          "wind_bearing": 321.5,
                          "cloud_coverage": 10.9,
                          "uv_index": 6.1,
                          "temperature": 93,
                          "wind_speed": 3.6,
                          "precipitation": 0.01,
                          "humidity": 55
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T21:00:00+00:00",
                          "wind_bearing": 285.4,
                          "cloud_coverage": 58.6,
                          "uv_index": 3.4,
                          "temperature": 91,
                          "wind_speed": 7.83,
                          "precipitation": 0.02,
                          "humidity": 59
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T22:00:00+00:00",
                          "wind_bearing": 276.0,
                          "cloud_coverage": 78.9,
                          "uv_index": 1.4,
                          "temperature": 87,
                          "wind_speed": 6.71,
                          "precipitation": 0.0,
                          "humidity": 69
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T23:00:00+00:00",
                          "wind_bearing": 23.2,
                          "cloud_coverage": 61.7,
                          "uv_index": 0.3,
                          "temperature": 85,
                          "wind_speed": 5.59,
                          "precipitation": 0.0,
                          "humidity": 73
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T00:00:00+00:00",
                          "wind_bearing": 51.4,
                          "cloud_coverage": 30.5,
                          "uv_index": 0.0,
                          "temperature": 83,
                          "wind_speed": 4.23,
                          "precipitation": 0.0,
                          "humidity": 80
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T01:00:00+00:00",
                          "wind_bearing": 45.3,
                          "cloud_coverage": 33.6,
                          "uv_index": 0.0,
                          "temperature": 81,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 84
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T02:00:00+00:00",
                          "wind_bearing": 32.7,
                          "cloud_coverage": 17.2,
                          "uv_index": 0.0,
                          "temperature": 80,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 87
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T03:00:00+00:00",
                          "wind_bearing": 44.0,
                          "cloud_coverage": 3.9,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T04:00:00+00:00",
                          "wind_bearing": 40.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T05:00:00+00:00",
                          "wind_bearing": 356.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T06:00:00+00:00",
                          "wind_bearing": 345.7,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T07:00:00+00:00",
                          "wind_bearing": 326.0,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 94
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T08:00:00+00:00",
                          "wind_bearing": 345.1,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 95
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T09:00:00+00:00",
                          "wind_bearing": 34.2,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.43,
                          "precipitation": 0.0,
                          "humidity": 96
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T10:00:00+00:00",
                          "wind_bearing": 345.8,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 1.12,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T11:00:00+00:00",
                          "wind_bearing": 343.2,
                          "cloud_coverage": 1.6,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.87,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T12:00:00+00:00",
                          "wind_bearing": 1.6,
                          "cloud_coverage": 7.8,
                          "uv_index": 0.4,
                          "temperature": 79,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 93
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T13:00:00+00:00",
                          "wind_bearing": 12.7,
                          "cloud_coverage": 6.2,
                          "uv_index": 1.6,
                          "temperature": 82,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 82
                        }
                      ]
                    }
                  }
                },
                "result": {
                  "params": {
                    "domain": "weather",
                    "service": "get_forecasts",
                    "service_data": {
                      "type": "hourly",
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    },
                    "target": {
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "action/1": [
              {
                "path": "action/1",
                "timestamp": "2025-08-15T13:25:40.102623+00:00"
              }
            ],
            "action/1/repeat/sequence/0": [
              {
                "path": "action/1/repeat/sequence/0",
                "timestamp": "2025-08-15T13:25:40.103306+00:00",
                "changed_variables": {
                  "repeat": {
                    "first": true,
                    "index": 1,
                    "last": true,
                    "item": "awtrix-clock/custom/jeef_weather"
                  }
                },
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "topic": "awtrix-clock/custom/jeef_weather",
                      "payload": {
                        "draw": [
                          {
                            "dp": [
                              8,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              9,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              10,
                              7,
                              "#D33F27"
                            ]
                          },
                          {
                            "dp": [
                              11,
                              7,
                              "#CC5127"
                            ]
                          },
                          {
                            "dp": [
                              12,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              13,
                              7,
                              "#C53527"
                            ]
                          },
                          {
                            "dp": [
                              14,
                              7,
                              "#C13327"
                            ]
                          },
                          {
                            "dp": [
                              15,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              16,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              17,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              18,
                              7,
                              "#EB6927"
                            ]
                          },
                          {
                            "dp": [
                              19,
                              7,
                              "#F37727"
                            ]
                          },
                          {
                            "dt": [
                              15.0,
                              1,
                              "86\u00b0",
                              "#EF7027"
                            ]
                          }
                        ],
                        "icon": "w-sunny",
                        "duration": 10,
                        "pushIcon": 2,
                        "lifetime": 120,
                        "lifetimeMode": 1,
                        "weather": "sunny"
                      }
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ],
            "action/1/repeat/sequence/1": [
              {
                "path": "action/1/repeat/sequence/1",
                "timestamp": "2025-08-15T13:25:40.113358+00:00",
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "qos": 0,
                      "retain": false,
                      "topic": "awtrix-clock/custom/jeef_weather_sun",
                      "payload": {}
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "mode": "restart",
            "variables": {
              "device_ids": [
                "a8583420298728779e89f960f8079d14"
              ],
              "app_topic": "jeef_weather",
              "topics": "{%- macro get_device_topic(device_id) %} {{ states((device_entities(device_id) | select('search','device_topic') | list)[0]) }} {%- endmacro %}\n{%- set ns = namespace(devices=[]) %} {%- for device_id in device_ids %}\n  {%- set device=get_device_topic(device_id)|replace(' ','') %}\n  {% set ns.devices = ns.devices + [ device ~ '/custom/' ~ app_topic] %}\n{%- endfor %} {{ ns.devices | reject('match','unavailable') | list}}",
              "forecast_var": "weather.forecast_home",
              "current_condition": "{{states(forecast_var)}}",
              "current_temp": "{{state_attr(forecast_var,'temperature')}}",
              "hours_to_show": 12,
              "moon": "sensor.moon_phase",
              "moon_phase": "{{states(moon)}}",
              "moon_times": "sensor.ip_geo_location",
              "moon_rise": "{{state_attr(moon_times,'moonrise')}}",
              "moon_set": "{{state_attr(moon_times,'moonset')}}",
              "moon_alt": "{{state_attr(moon_times,'moon_altitude')}}",
              "moon_risen": "{{moon_alt > 0}}",
              "when_show_moon": "night",
              "show_moon": "{%- if when_show_moon == 'always' %} True {%- elif when_show_moon == 'never' %} False {%- elif when_show_moon == 'risen' %} {{moon_risen}} {%- else %} {{state_attr('sun.sun', 'elevation') < 0 and moon_risen}} {%- endif %}",
              "message_duration": 10,
              "message_duration_riseset": 0,
              "current_temp_var": "sensor.kflwildw56_local_temperature",
              "temp_digits": 0,
              "temp_suffix": "\u00b0",
              "temp_text": "{%- macro round_and_set_temp(temp_var, temp_suffix, digits=0) -%} {%- if has_value(temp_var) -%}\n  {{ states(temp_var) | round(digits) ~ temp_suffix}} \n{%- else -%} {{current_temp ~ temp_suffix}} {%- endif -%} {%- endmacro -%} {{ round_and_set_temp(current_temp_var, temp_suffix, temp_digits)}}",
              "text_available_width": "{%- if show_moon %}16{%- else %}24{%- endif %}\n",
              "text_len": "{%- macro get_text_len(string) %} {%- set length = namespace(value=0) %} {%- for char in string %}\n  {%- if char.isdigit() %}\n    {%- set length.value = length.value + 3 %}\n  {%- elif char == '\u00b0' %}\n    {%- set length.value = length.value + 2 %}\n  {%- elif char == '.' %}\n    {%- set length.value = length.value + 1 %}\n  {%- elif char in ['-','C','F'] %}\n    {%- set length.value = length.value + 3 %}\n  {%- else %}\n    {%- set length.value = length.value + 1 %}\n  {%- endif %}\n  {%- if not loop.last %}\n    {%- set length.value = length.value + 1 %}{%- endif -%}\n{%- endfor -%} {{ length.value }} {%- endmacro %}\n{{get_text_len(temp_text)}}",
              "text_x": "{{8 + ((text_available_width - text_len)/2)}}",
              "sun_event_minute_threshold": 30,
              "sun_time_type": "Actual",
              "sun_time_format": "%-I%M%p",
              "icon_sunrise": "w-sunrise",
              "icon_sunset": "w-sunset",
              "show_sun_rise_set": false,
              "sun_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(ts_set < ts_rise,'sunset','sunrise') }}",
              "sun_min_until_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(sun_next_event == 'sunrise',(ts_rise - utcnow()|as_timestamp) / 60,(ts_set - utcnow()|as_timestamp) / 60) | round(0) }}",
              "sun_next_str": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {%- if sun_time_type == 'Actual' %}\n  {{ iif(sun_next_event == 'sunrise',(ts_rise | as_datetime | as_local).strftime(sun_time_format),  (ts_set | as_datetime | as_local).strftime(sun_time_format)) }}\n{%- else %} {#- relative time #}\n  {% set hours = sun_min_until_next_event // 60 %}\n  {% set remaining_minutes = sun_min_until_next_event % 60 %}\n\n  {% if hours == 0 %}\n      {{ remaining_minutes }} min\n  {% else %}\n      [\n        {\"t\":\"{{hours}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"h\", \"c\":\"#9c9d97\"},\n        {\"t\":\"{{remaining_minutes}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"m\", \"c\":\"#9c9d97\"}\n    ]\n  {% endif %}\n  \n{%- endif %}",
              "sun_event_icon": "{{ iif(sun_next_event == 'sunrise', icon_sunrise, icon_sunset) }}",
              "sun_event_payload": "{\"icon\":\"{{sun_event_icon}}\", \"text\":\"{{sun_next_str}}\", \"duration\": {{message_duration_riseset}}}",
              "sun_payload": "{%- if show_sun_rise_set %} {{ iif(sun_event_minute_threshold >= sun_min_until_next_event, sun_event_payload, \"{}\") }} {%- else %} {} {%- endif %}",
              "icon_clear_night": "w-clear-night",
              "use_moon_clear_night": true,
              "use_moon_sunny_night": true,
              "icon_cloudy": "w-cloudy",
              "icon_exceptional": "w-exceptional",
              "icon_fog": "w-fog",
              "icon_hail": "w-hail",
              "icon_lightning": "w-lightning",
              "icon_lightning_rainy": "w-lightning-rainy",
              "icon_partlycloudy": "w-partlycloudy",
              "icon_pouring": "w-pouring",
              "icon_rainy": "w-rainy",
              "icon_snowy": "w-snowy",
              "icon_snowy_rainy": "w-snowy-rainy",
              "icon_sunny": "w-sunny",
              "icon_windy": "w-windy",
              "icon_windy_variant": "w-windy-variant",
              "clear_night_dict": "{{ dict({\n  'full_moon': '2314',\n  'waning_gibbous': '2315',\n  'last_quarter': '2316',\n  'waning_crescent': '2317',\n  'new_moon': '2318',\n  'waxing_crescent': '2319',\n  'first_quarter': '2320',\n  'waxing_gibbous': '2321'}) }}",
              "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
              "color_dict": "{% set b = color_matrix_json | from_json %}     {%- set ns = namespace(tuples=[]) %} {%- for k,v in b | items -%}\n  {%- set key = k|float -%}\n  {%- set ns.tuples = ns.tuples + [(key,v)] %}      \n{% endfor %} {{ dict.from_keys(ns.tuples) }}",
              "icon_dict": "{{ dict({'clear-night': icon_clear_night, 'cloudy': icon_cloudy, 'exceptional': icon_exceptional, 'fog': icon_fog, 'hail': icon_hail, 'lightning': icon_lightning, 'lightning-rainy': icon_lightning_rainy, 'partlycloudy': icon_partlycloudy, 'pouring': icon_pouring, 'rainy': icon_rainy, 'snowy': icon_snowy, 'snowy-rainy': icon_snowy_rainy, 'sunny': icon_sunny, 'windy': icon_windy,  'windy-variant': icon_windy_variant})}}",
              "icon": "{%- if ((current_condition == 'clear_night') and use_moon_clear_night) %}\n  {{clear_night_dict[moon_phase]}}\n{%- elif (sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%}\n  \n{%- else %}\n  {{ icon_dict[current_condition] }}\n{%- endif %}\n",
              "moon_data": "{%- macro draw_moon(phase,x=22,y=0) %}\n  {%- if phase == 'first_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,15790320,14079702,14079702,0,3355443,3355443,3355443,3355443,13355979,13355979,14079702,14079702,3355443,3355443,1644825,3355443,13355979,15790320,15790320,14079702,3355443,3355443,1644825,3355443,15790320,15790320,15790320,14079702,3355443,3355443,3355443,3355443,15790320,13355979,14079702,14079702,0,3355443,3355443,3355443,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'full_moon'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,14079702,14079702,0,0,0,14079702,14079702,15790320,15790320,14079702,14079702,0,14079702,14079702,15790320,15790320,11974326,11974326,14079702,14079702,14079702,15790320,11974326,15790320,11974326,15790320,15790320,14079702,14079702,15790320,11974326,15790320,15790320,15790320,15790320,14079702,14079702,14079702,15790320,15790320,15790320,11974326,14079702,14079702,0,14079702,14079702,11974326,15790320,14079702,14079702,0,0,0,14079702,14079702,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'last_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3487029,3487029,0,0,0,14079702,14079702,15790320,3487029,3487029,3487029,0,14079702,14079702,15790320,15790320,1907997,1907997,3487029,3487029,14079702,15790320,13553358,15790320,1907997,3487029,3487029,3487029,14079702,15790320,13553358,15790320,3487029,3487029,3487029,3487029,14079702,14079702,15790320,15790320,3487029,1907997,3487029,3487029,0,14079702,14079702,13553358,3487029,3487029,3487029,0,0,0,14079702,14079702,3487029,3487029,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'new_moon' %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,2763306,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,2763306,2763306,0,2763306,2763306,2763306,2763306,1842204,1842204,2763306,2763306,2763306,2763306,1842204,2763306,1842204,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,0,2763306,2763306,1842204,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,2763306,2763306,0,14079702,14079702,2763306,2763306,1842204,1842204,2763306,2763306,14079702,15790320,1842204,2763306,1842204,2763306,2763306,2763306,14079702,15790320,1842204,2763306,2763306,2763306,2763306,2763306,14079702,14079702,2763306,2763306,2763306,1842204,2763306,2763306,0,14079702,14079702,1842204,2763306,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3552822,3552822,0,0,0,14079702,14079702,15790320,15790320,3552822,3552822,0,14079702,14079702,15790320,15790320,13421772,13421772,3552822,3552822,14079702,15790320,13421772,15790320,13421772,15790320,3552822,3552822,14079702,15790320,13421772,15790320,15790320,15790320,3552822,3552822,14079702,14079702,15790320,15790320,15790320,13421772,3552822,3552822,0,14079702,14079702,13421772,15790320,3552822,3552822,0,0,0,14079702,14079702,3552822,3552822,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,3355443,14079702,14079702,0,3355443,3355443,3355443,3355443,1644825,1644825,14079702,14079702,3355443,3355443,1644825,3355443,1644825,3355443,15790320,14079702,3355443,3355443,1644825,3355443,3355443,3355443,15790320,14079702,3355443,3355443,3355443,3355443,3355443,1644825,14079702,14079702,0,3355443,3355443,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,15790320,14079702,14079702,0,3355443,3355443,15790320,15790320,12763842,12763842,14079702,14079702,3355443,3355443,12763842,15790320,12763842,15790320,15790320,14079702,3355443,3355443,12763842,15790320,15790320,15790320,15790320,14079702,3355443,3355443,15790320,15790320,15790320,12763842,14079702,14079702,0,3355443,3355443,12763842,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n{%- endmacro %}\n{%- if current_condition == 'clear-night' and use_moon_clear_night -%} {{draw_moon(moon_phase,0,0)}} {%- elif(sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%} {{draw_moon(moon_phase,0,0)}} {%- else -%} {{draw_moon(moon_phase,23,0)}} {%- endif -%}\n"
            },
            "triggers": [
              {
                "platform": "time_pattern",
                "seconds": "/5"
              },
              {
                "platform": "state",
                "entity_id": "weather.forecast_home",
                "id": "Changes",
                "enabled": true
              }
            ],
            "actions": [
              {
                "target": {
                  "entity_id": "{{forecast_var}}"
                },
                "data": {
                  "type": "hourly"
                },
                "response_variable": "forecast_response",
                "action": "weather.get_forecasts"
              },
              {
                "repeat": {
                  "for_each": "{{ topics }}",
                  "sequence": [
                    {
                      "data": {
                        "topic": "{{repeat.item}}",
                        "payload": "{%- set forecast = forecast_response[forecast_var]['forecast'] -%} {%- macro interpolate(dictionary, x) -%} {%- set sorted_keys = dictionary|dictsort -%} {%- set above = sorted_keys|selectattr('0', 'gt', x)|map(attribute='0')|list|first -%} {%- set below = sorted_keys|selectattr('0', 'lt', x)|map(attribute='0')|list|last -%}\n{#- Key matches x exactly -#} {%- if above is defined and dictionary[above] == x -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{%- elif below is defined and dictionary[below] == x -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Interpolation between two values -#} {%- elif below is defined and above is defined -%}\n  {%- set lower_value = dictionary[below] -%}\n  {%- set upper_value = dictionary[above] -%}\n  {%- set lower_rgb = lower_value[1:] -%}\n  {%- set upper_rgb = upper_value[1:] -%}\n\n  {%- set lower_r = lower_rgb[0:2]|int(base=16) -%}\n  {%- set lower_g = lower_rgb[2:4]|int(base=16) -%}\n  {%- set lower_b = lower_rgb[4:6]|int(base=16) -%}\n\n  {%- set upper_r = upper_rgb[0:2]|int(base=16) -%}\n  {%- set upper_g = upper_rgb[2:4]|int(base=16) -%}\n  {%- set upper_b = upper_rgb[4:6]|int(base=16) -%}\n\n  {%- set interpolation_factor = (x - below) / (above - below) -%}\n  {%- set interpolated_r = ((1 - interpolation_factor) * lower_r + interpolation_factor * upper_r)|int -%}\n  {%- set interpolated_g = ((1 - interpolation_factor) * lower_g + interpolation_factor * upper_g)|int -%}\n  {%- set interpolated_b = ((1 - interpolation_factor) * lower_b + interpolation_factor * upper_b)|int -%}\n\n  {%- set interpolated_hex = '#' ~ '%02X' % interpolated_r ~ '%02X' % interpolated_g ~ '%02X' % interpolated_b -%}\n  {{ interpolated_hex }}\n{#- Only below key available -#} {%- elif below is defined -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Only above key available -#} {%- elif above is defined -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{#- No matching keys available -#} {%- else -%}\n  No matching key found.\n{%- endif -%} {%- endmacro -%}\n{#- Define macro to get length of the forecast -#} {%- macro str_len(stringo) %} {%- if '.' in stringo %} {%- set char_count = (stringo | length) -1 %}{{char_count * 3 + 1 + char_count}} {%- else %} {%- set char_count = (stringo | length) %}{{char_count * 3 + (char_count - 1)}} {%- endif %} {%- endmacro %}\n{#- Define a macro to draw out the forecast lines#}\n  {%- macro draw_forecast_lines(x,hours,height) %}\n    {%- for hour in range(hours) %}\n      {%- if height == 0 %}\n        {\"dp\": [{{x+hour}},7,\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- else %}\n        {\"dl\": [{{x+hour}},7,{{x+hour}},{{7 - height}},\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- endif %}\n      {%- if hour+1 != hours %},{%endif%}\n    {%- endfor %}\n  {%- endmacro %}\n\n  {\n    \"draw\": [\n      {%- if hours_to_show > 0 %}\n      {{draw_forecast_lines(8,hours_to_show,0)}}\n    {%- endif %}\n    {%- if current_temp != 'unavailable' -%}\n    ,{\"dt\":[{{text_x}},1,\"{{temp_text}}\",\"{{interpolate(color_dict, current_temp | float)}}\"]}\n    {%- else -%}\n    {\"dt\":\"err\"}\n    {%- endif -%}\n\n    {% if show_moon %}\n    ,{{moon_data}}\n    {% endif %}\n    ],\n    \"icon\": \"{{icon}}\",\n    \"duration\": {{message_duration}},\n    \"pushIcon\": 2,\n    \"lifetime\": 120,\n    \"lifetimeMode\":1,\n    \"weather\": \"{{current_condition}}\"\n    }"
                      },
                      "action": "mqtt.publish"
                    },
                    {
                      "data": {
                        "qos": 0,
                        "retain": false,
                        "topic": "{{ repeat.item ~ '_sun'}} ",
                        "payload": "{{sun_payload}}\n"
                      },
                      "action": "mqtt.publish"
                    }
                  ]
                }
              }
            ],
            "conditions": [],
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather"
          },
          "blueprint_inputs": {
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather",
            "use_blueprint": {
              "path": "jeeftor/awtrix_weatherflow.yaml",
              "input": {
                "awtrix": [
                  "a8583420298728779e89f960f8079d14"
                ],
                "forecast_var": "weather.forecast_home",
                "forecast_temp_field": "temperature",
                "temp_suffix": "\u00b0",
                "current_temp_var": "sensor.kflwildw56_local_temperature",
                "moon": "sensor.moon_phase",
                "moon_rise_set": "sensor.ip_geo_location",
                "show_sun_rise_set": false,
                "message_duration_riseset": 0,
                "message_duration_forecast": 10,
                "hours_to_show": 12,
                "temp_digits": 0
              }
            }
          },
          "context": {
            "id": "01K2PYGM3Y8AGR8ZGRHWRRHM5T",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "9c1e83ab73484c2ff449b898703eeb70",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:40.094207+00:00",
            "finish": "2025-08-15T13:25:40.118841+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern"
        }
      },
      {
        "extended_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "4ac34888690064c7b43ccdc693bc4428",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:45.094052+00:00",
            "finish": "2025-08-15T13:25:45.118808+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern",
          "trace": {
            "trigger/0": [
              {
                "path": "trigger/0",
                "timestamp": "2025-08-15T13:25:45.099509+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.awtrix_mega_weather",
                    "state": "on",
                    "attributes": {
                      "id": "1710004236293",
                      "last_triggered": "2025-08-15T13:25:40.100170+00:00",
                      "mode": "restart",
                      "current": 0,
                      "friendly_name": "awtrix_mega_weather",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.874702+00:00",
                    "last_reported": "2025-08-15T13:25:40.118462+00:00",
                    "last_updated": "2025-08-15T13:25:40.118462+00:00",
                    "context": {
                      "id": "01K2PYGM3Y8AGR8ZGRHWRRHM5T",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "0",
                    "idx": "0",
                    "alias": null,
                    "platform": "time_pattern",
                    "now": "2025-08-15T09:25:45.093809-04:00",
                    "description": "time pattern"
                  },
                  "device_ids": [
                    "a8583420298728779e89f960f8079d14"
                  ],
                  "app_topic": "jeef_weather",
                  "topics": [
                    "awtrix-clock/custom/jeef_weather"
                  ],
                  "forecast_var": "weather.forecast_home",
                  "current_condition": "sunny",
                  "current_temp": 82,
                  "hours_to_show": 12,
                  "moon": "sensor.moon_phase",
                  "moon_phase": "waning_gibbous",
                  "moon_times": "sensor.ip_geo_location",
                  "moon_rise": "-:-",
                  "moon_set": "13:31",
                  "moon_alt": 50.388162613986886,
                  "moon_risen": true,
                  "when_show_moon": "night",
                  "show_moon": false,
                  "message_duration": 10,
                  "message_duration_riseset": 0,
                  "current_temp_var": "sensor.kflwildw56_local_temperature",
                  "temp_digits": 0,
                  "temp_suffix": "\u00b0",
                  "temp_text": "86\u00b0",
                  "text_available_width": 24,
                  "text_len": 10,
                  "text_x": 15.0,
                  "sun_event_minute_threshold": 30,
                  "sun_time_type": "Actual",
                  "sun_time_format": "%-I%M%p",
                  "icon_sunrise": "w-sunrise",
                  "icon_sunset": "w-sunset",
                  "show_sun_rise_set": false,
                  "sun_next_event": "sunset",
                  "sun_min_until_next_event": 642,
                  "sun_next_str": "807PM",
                  "sun_event_icon": "w-sunset",
                  "sun_event_payload": {
                    "icon": "w-sunset",
                    "text": "807PM",
                    "duration": 0
                  },
                  "sun_payload": {},
                  "icon_clear_night": "w-clear-night",
                  "use_moon_clear_night": true,
                  "use_moon_sunny_night": true,
                  "icon_cloudy": "w-cloudy",
                  "icon_exceptional": "w-exceptional",
                  "icon_fog": "w-fog",
                  "icon_hail": "w-hail",
                  "icon_lightning": "w-lightning",
                  "icon_lightning_rainy": "w-lightning-rainy",
                  "icon_partlycloudy": "w-partlycloudy",
                  "icon_pouring": "w-pouring",
                  "icon_rainy": "w-rainy",
                  "icon_snowy": "w-snowy",
                  "icon_snowy_rainy": "w-snowy-rainy",
                  "icon_sunny": "w-sunny",
                  "icon_windy": "w-windy",
                  "icon_windy_variant": "w-windy-variant",
                  "clear_night_dict": {
                    "full_moon": "2314",
                    "waning_gibbous": "2315",
                    "last_quarter": "2316",
                    "waning_crescent": "2317",
                    "new_moon": "2318",
                    "waxing_crescent": "2319",
                    "first_quarter": "2320",
                    "waxing_gibbous": "2321"
                  },
                  "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
                  "color_dict": {
                    "0.0": "#FEC4FF",
                    "10.0": "#D977DF",
                    "20.0": "#9545BC",
                    "30.0": "#4B379C",
                    "40.0": "#31B8DB",
                    "50.0": "#31DB8B",
                    "60.0": "#6ED228",
                    "70.0": "#FFFF28",
                    "80.0": "#F87E27",
                    "90.0": "#CF3927",
                    "100.0": "#A12527"
                  },
                  "icon_dict": {
                    "clear-night": "w-clear-night",
                    "cloudy": "w-cloudy",
                    "exceptional": "w-exceptional",
                    "fog": "w-fog",
                    "hail": "w-hail",
                    "lightning": "w-lightning",
                    "lightning-rainy": "w-lightning-rainy",
                    "partlycloudy": "w-partlycloudy",
                    "pouring": "w-pouring",
                    "rainy": "w-rainy",
                    "snowy": "w-snowy",
                    "snowy-rainy": "w-snowy-rainy",
                    "sunny": "w-sunny",
                    "windy": "w-windy",
                    "windy-variant": "w-windy-variant"
                  },
                  "icon": "w-sunny",
                  "moon_data": {
                    "db": [
                      23,
                      0,
                      8,
                      8,
                      [
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        13421772,
                        13421772,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        15790320,
                        13421772,
                        15790320,
                        15790320,
                        15790320,
                        3552822,
                        3552822,
                        14079702,
                        14079702,
                        15790320,
                        15790320,
                        15790320,
                        13421772,
                        3552822,
                        3552822,
                        0,
                        14079702,
                        14079702,
                        13421772,
                        15790320,
                        3552822,
                        3552822,
                        0,
                        0,
                        0,
                        14079702,
                        14079702,
                        3552822,
                        3552822,
                        0,
                        0
                      ]
                    ]
                  }
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:25:45.100105+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYGS05JY9CME0WG83TZDQA",
                    "parent_id": null,
                    "user_id": null
                  },
                  "forecast_response": {
                    "weather.forecast_home": {
                      "forecast": [
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T14:00:00+00:00",
                          "wind_bearing": 348.6,
                          "cloud_coverage": 7.0,
                          "uv_index": 3.9,
                          "temperature": 85,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 81
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T15:00:00+00:00",
                          "wind_bearing": 355.2,
                          "cloud_coverage": 18.7,
                          "uv_index": 6.6,
                          "temperature": 87,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 72
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T16:00:00+00:00",
                          "wind_bearing": 349.3,
                          "cloud_coverage": 21.1,
                          "uv_index": 9.1,
                          "temperature": 89,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 65
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T17:00:00+00:00",
                          "wind_bearing": 310.7,
                          "cloud_coverage": 18.0,
                          "uv_index": 10.5,
                          "temperature": 90,
                          "wind_speed": 2.67,
                          "precipitation": 0.0,
                          "humidity": 60
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T18:00:00+00:00",
                          "wind_bearing": 289.1,
                          "cloud_coverage": 12.5,
                          "uv_index": 10.4,
                          "temperature": 91,
                          "wind_speed": 3.36,
                          "precipitation": 0.0,
                          "humidity": 58
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-15T19:00:00+00:00",
                          "wind_bearing": 289.6,
                          "cloud_coverage": 12.5,
                          "uv_index": 8.7,
                          "temperature": 92,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 56
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T20:00:00+00:00",
                          "wind_bearing": 321.5,
                          "cloud_coverage": 10.9,
                          "uv_index": 6.1,
                          "temperature": 93,
                          "wind_speed": 3.6,
                          "precipitation": 0.01,
                          "humidity": 55
                        },
                        {
                          "condition": "rainy",
                          "datetime": "2025-08-15T21:00:00+00:00",
                          "wind_bearing": 285.4,
                          "cloud_coverage": 58.6,
                          "uv_index": 3.4,
                          "temperature": 91,
                          "wind_speed": 7.83,
                          "precipitation": 0.02,
                          "humidity": 59
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T22:00:00+00:00",
                          "wind_bearing": 276.0,
                          "cloud_coverage": 78.9,
                          "uv_index": 1.4,
                          "temperature": 87,
                          "wind_speed": 6.71,
                          "precipitation": 0.0,
                          "humidity": 69
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-15T23:00:00+00:00",
                          "wind_bearing": 23.2,
                          "cloud_coverage": 61.7,
                          "uv_index": 0.3,
                          "temperature": 85,
                          "wind_speed": 5.59,
                          "precipitation": 0.0,
                          "humidity": 73
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T00:00:00+00:00",
                          "wind_bearing": 51.4,
                          "cloud_coverage": 30.5,
                          "uv_index": 0.0,
                          "temperature": 83,
                          "wind_speed": 4.23,
                          "precipitation": 0.0,
                          "humidity": 80
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T01:00:00+00:00",
                          "wind_bearing": 45.3,
                          "cloud_coverage": 33.6,
                          "uv_index": 0.0,
                          "temperature": 81,
                          "wind_speed": 3.79,
                          "precipitation": 0.0,
                          "humidity": 84
                        },
                        {
                          "condition": "partlycloudy",
                          "datetime": "2025-08-16T02:00:00+00:00",
                          "wind_bearing": 32.7,
                          "cloud_coverage": 17.2,
                          "uv_index": 0.0,
                          "temperature": 80,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 87
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T03:00:00+00:00",
                          "wind_bearing": 44.0,
                          "cloud_coverage": 3.9,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T04:00:00+00:00",
                          "wind_bearing": 40.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 90
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T05:00:00+00:00",
                          "wind_bearing": 356.6,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 79,
                          "wind_speed": 1.99,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T06:00:00+00:00",
                          "wind_bearing": 345.7,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 92
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T07:00:00+00:00",
                          "wind_bearing": 326.0,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 94
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T08:00:00+00:00",
                          "wind_bearing": 345.1,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 78,
                          "wind_speed": 1.37,
                          "precipitation": 0.0,
                          "humidity": 95
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T09:00:00+00:00",
                          "wind_bearing": 34.2,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.43,
                          "precipitation": 0.0,
                          "humidity": 96
                        },
                        {
                          "condition": "clear-night",
                          "datetime": "2025-08-16T10:00:00+00:00",
                          "wind_bearing": 345.8,
                          "cloud_coverage": 0.0,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 1.12,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T11:00:00+00:00",
                          "wind_bearing": 343.2,
                          "cloud_coverage": 1.6,
                          "uv_index": 0.0,
                          "temperature": 77,
                          "wind_speed": 0.87,
                          "precipitation": 0.0,
                          "humidity": 97
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T12:00:00+00:00",
                          "wind_bearing": 1.6,
                          "cloud_coverage": 7.8,
                          "uv_index": 0.4,
                          "temperature": 79,
                          "wind_speed": 2.92,
                          "precipitation": 0.0,
                          "humidity": 93
                        },
                        {
                          "condition": "sunny",
                          "datetime": "2025-08-16T13:00:00+00:00",
                          "wind_bearing": 12.7,
                          "cloud_coverage": 6.2,
                          "uv_index": 1.6,
                          "temperature": 82,
                          "wind_speed": 1.8,
                          "precipitation": 0.0,
                          "humidity": 82
                        }
                      ]
                    }
                  }
                },
                "result": {
                  "params": {
                    "domain": "weather",
                    "service": "get_forecasts",
                    "service_data": {
                      "type": "hourly",
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    },
                    "target": {
                      "entity_id": [
                        "weather.forecast_home"
                      ]
                    }
                  },
                  "running_script": false
                }
              }
            ],
            "action/1": [
              {
                "path": "action/1",
                "timestamp": "2025-08-15T13:25:45.102444+00:00"
              }
            ],
            "action/1/repeat/sequence/0": [
              {
                "path": "action/1/repeat/sequence/0",
                "timestamp": "2025-08-15T13:25:45.103220+00:00",
                "changed_variables": {
                  "repeat": {
                    "first": true,
                    "index": 1,
                    "last": true,
                    "item": "awtrix-clock/custom/jeef_weather"
                  }
                },
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "topic": "awtrix-clock/custom/jeef_weather",
                      "payload": {
                        "draw": [
                          {
                            "dp": [
                              8,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              9,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              10,
                              7,
                              "#D33F27"
                            ]
                          },
                          {
                            "dp": [
                              11,
                              7,
                              "#CC5127"
                            ]
                          },
                          {
                            "dp": [
                              12,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              13,
                              7,
                              "#C53527"
                            ]
                          },
                          {
                            "dp": [
                              14,
                              7,
                              "#C13327"
                            ]
                          },
                          {
                            "dp": [
                              15,
                              7,
                              "#CA3727"
                            ]
                          },
                          {
                            "dp": [
                              16,
                              7,
                              "#DB4D27"
                            ]
                          },
                          {
                            "dp": [
                              17,
                              7,
                              "#E35B27"
                            ]
                          },
                          {
                            "dp": [
                              18,
                              7,
                              "#EB6927"
                            ]
                          },
                          {
                            "dp": [
                              19,
                              7,
                              "#F37727"
                            ]
                          },
                          {
                            "dt": [
                              15.0,
                              1,
                              "86\u00b0",
                              "#EF7027"
                            ]
                          }
                        ],
                        "icon": "w-sunny",
                        "duration": 10,
                        "pushIcon": 2,
                        "lifetime": 120,
                        "lifetimeMode": 1,
                        "weather": "sunny"
                      }
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ],
            "action/1/repeat/sequence/1": [
              {
                "path": "action/1/repeat/sequence/1",
                "timestamp": "2025-08-15T13:25:45.113032+00:00",
                "result": {
                  "params": {
                    "domain": "mqtt",
                    "service": "publish",
                    "service_data": {
                      "qos": 0,
                      "retain": false,
                      "topic": "awtrix-clock/custom/jeef_weather_sun",
                      "payload": {}
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "mode": "restart",
            "variables": {
              "device_ids": [
                "a8583420298728779e89f960f8079d14"
              ],
              "app_topic": "jeef_weather",
              "topics": "{%- macro get_device_topic(device_id) %} {{ states((device_entities(device_id) | select('search','device_topic') | list)[0]) }} {%- endmacro %}\n{%- set ns = namespace(devices=[]) %} {%- for device_id in device_ids %}\n  {%- set device=get_device_topic(device_id)|replace(' ','') %}\n  {% set ns.devices = ns.devices + [ device ~ '/custom/' ~ app_topic] %}\n{%- endfor %} {{ ns.devices | reject('match','unavailable') | list}}",
              "forecast_var": "weather.forecast_home",
              "current_condition": "{{states(forecast_var)}}",
              "current_temp": "{{state_attr(forecast_var,'temperature')}}",
              "hours_to_show": 12,
              "moon": "sensor.moon_phase",
              "moon_phase": "{{states(moon)}}",
              "moon_times": "sensor.ip_geo_location",
              "moon_rise": "{{state_attr(moon_times,'moonrise')}}",
              "moon_set": "{{state_attr(moon_times,'moonset')}}",
              "moon_alt": "{{state_attr(moon_times,'moon_altitude')}}",
              "moon_risen": "{{moon_alt > 0}}",
              "when_show_moon": "night",
              "show_moon": "{%- if when_show_moon == 'always' %} True {%- elif when_show_moon == 'never' %} False {%- elif when_show_moon == 'risen' %} {{moon_risen}} {%- else %} {{state_attr('sun.sun', 'elevation') < 0 and moon_risen}} {%- endif %}",
              "message_duration": 10,
              "message_duration_riseset": 0,
              "current_temp_var": "sensor.kflwildw56_local_temperature",
              "temp_digits": 0,
              "temp_suffix": "\u00b0",
              "temp_text": "{%- macro round_and_set_temp(temp_var, temp_suffix, digits=0) -%} {%- if has_value(temp_var) -%}\n  {{ states(temp_var) | round(digits) ~ temp_suffix}} \n{%- else -%} {{current_temp ~ temp_suffix}} {%- endif -%} {%- endmacro -%} {{ round_and_set_temp(current_temp_var, temp_suffix, temp_digits)}}",
              "text_available_width": "{%- if show_moon %}16{%- else %}24{%- endif %}\n",
              "text_len": "{%- macro get_text_len(string) %} {%- set length = namespace(value=0) %} {%- for char in string %}\n  {%- if char.isdigit() %}\n    {%- set length.value = length.value + 3 %}\n  {%- elif char == '\u00b0' %}\n    {%- set length.value = length.value + 2 %}\n  {%- elif char == '.' %}\n    {%- set length.value = length.value + 1 %}\n  {%- elif char in ['-','C','F'] %}\n    {%- set length.value = length.value + 3 %}\n  {%- else %}\n    {%- set length.value = length.value + 1 %}\n  {%- endif %}\n  {%- if not loop.last %}\n    {%- set length.value = length.value + 1 %}{%- endif -%}\n{%- endfor -%} {{ length.value }} {%- endmacro %}\n{{get_text_len(temp_text)}}",
              "text_x": "{{8 + ((text_available_width - text_len)/2)}}",
              "sun_event_minute_threshold": 30,
              "sun_time_type": "Actual",
              "sun_time_format": "%-I%M%p",
              "icon_sunrise": "w-sunrise",
              "icon_sunset": "w-sunset",
              "show_sun_rise_set": false,
              "sun_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(ts_set < ts_rise,'sunset','sunrise') }}",
              "sun_min_until_next_event": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {{ iif(sun_next_event == 'sunrise',(ts_rise - utcnow()|as_timestamp) / 60,(ts_set - utcnow()|as_timestamp) / 60) | round(0) }}",
              "sun_next_str": "{%- set rise = state_attr('sun.sun','next_rising') %} {%- set set = state_attr('sun.sun','next_setting') %} {%- set ts_rise = rise |as_timestamp %} {%- set ts_set = set |as_timestamp %} {%- if sun_time_type == 'Actual' %}\n  {{ iif(sun_next_event == 'sunrise',(ts_rise | as_datetime | as_local).strftime(sun_time_format),  (ts_set | as_datetime | as_local).strftime(sun_time_format)) }}\n{%- else %} {#- relative time #}\n  {% set hours = sun_min_until_next_event // 60 %}\n  {% set remaining_minutes = sun_min_until_next_event % 60 %}\n\n  {% if hours == 0 %}\n      {{ remaining_minutes }} min\n  {% else %}\n      [\n        {\"t\":\"{{hours}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"h\", \"c\":\"#9c9d97\"},\n        {\"t\":\"{{remaining_minutes}}\", \"c\":\"#ffffff\"},\n        {\"t\":\"m\", \"c\":\"#9c9d97\"}\n    ]\n  {% endif %}\n  \n{%- endif %}",
              "sun_event_icon": "{{ iif(sun_next_event == 'sunrise', icon_sunrise, icon_sunset) }}",
              "sun_event_payload": "{\"icon\":\"{{sun_event_icon}}\", \"text\":\"{{sun_next_str}}\", \"duration\": {{message_duration_riseset}}}",
              "sun_payload": "{%- if show_sun_rise_set %} {{ iif(sun_event_minute_threshold >= sun_min_until_next_event, sun_event_payload, \"{}\") }} {%- else %} {} {%- endif %}",
              "icon_clear_night": "w-clear-night",
              "use_moon_clear_night": true,
              "use_moon_sunny_night": true,
              "icon_cloudy": "w-cloudy",
              "icon_exceptional": "w-exceptional",
              "icon_fog": "w-fog",
              "icon_hail": "w-hail",
              "icon_lightning": "w-lightning",
              "icon_lightning_rainy": "w-lightning-rainy",
              "icon_partlycloudy": "w-partlycloudy",
              "icon_pouring": "w-pouring",
              "icon_rainy": "w-rainy",
              "icon_snowy": "w-snowy",
              "icon_snowy_rainy": "w-snowy-rainy",
              "icon_sunny": "w-sunny",
              "icon_windy": "w-windy",
              "icon_windy_variant": "w-windy-variant",
              "clear_night_dict": "{{ dict({\n  'full_moon': '2314',\n  'waning_gibbous': '2315',\n  'last_quarter': '2316',\n  'waning_crescent': '2317',\n  'new_moon': '2318',\n  'waxing_crescent': '2319',\n  'first_quarter': '2320',\n  'waxing_gibbous': '2321'}) }}",
              "color_matrix_json": "{\n  \"0\": \"#FEC4FF\",\n  \"10\": \"#D977DF\",\n  \"20\": \"#9545BC\",\n  \"30\": \"#4B379C\",\n  \"40\": \"#31B8DB\",\n  \"50\": \"#31DB8B\",\n  \"60\": \"#6ED228\",\n  \"70\": \"#FFFF28\",\n  \"80\": \"#F87E27\",\n  \"90\": \"#CF3927\",\n  \"100\": \"#A12527\"\n}\n",
              "color_dict": "{% set b = color_matrix_json | from_json %}     {%- set ns = namespace(tuples=[]) %} {%- for k,v in b | items -%}\n  {%- set key = k|float -%}\n  {%- set ns.tuples = ns.tuples + [(key,v)] %}      \n{% endfor %} {{ dict.from_keys(ns.tuples) }}",
              "icon_dict": "{{ dict({'clear-night': icon_clear_night, 'cloudy': icon_cloudy, 'exceptional': icon_exceptional, 'fog': icon_fog, 'hail': icon_hail, 'lightning': icon_lightning, 'lightning-rainy': icon_lightning_rainy, 'partlycloudy': icon_partlycloudy, 'pouring': icon_pouring, 'rainy': icon_rainy, 'snowy': icon_snowy, 'snowy-rainy': icon_snowy_rainy, 'sunny': icon_sunny, 'windy': icon_windy,  'windy-variant': icon_windy_variant})}}",
              "icon": "{%- if ((current_condition == 'clear_night') and use_moon_clear_night) %}\n  {{clear_night_dict[moon_phase]}}\n{%- elif (sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%}\n  \n{%- else %}\n  {{ icon_dict[current_condition] }}\n{%- endif %}\n",
              "moon_data": "{%- macro draw_moon(phase,x=22,y=0) %}\n  {%- if phase == 'first_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,15790320,14079702,14079702,0,3355443,3355443,3355443,3355443,13355979,13355979,14079702,14079702,3355443,3355443,1644825,3355443,13355979,15790320,15790320,14079702,3355443,3355443,1644825,3355443,15790320,15790320,15790320,14079702,3355443,3355443,3355443,3355443,15790320,13355979,14079702,14079702,0,3355443,3355443,3355443,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'full_moon'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,14079702,14079702,0,0,0,14079702,14079702,15790320,15790320,14079702,14079702,0,14079702,14079702,15790320,15790320,11974326,11974326,14079702,14079702,14079702,15790320,11974326,15790320,11974326,15790320,15790320,14079702,14079702,15790320,11974326,15790320,15790320,15790320,15790320,14079702,14079702,14079702,15790320,15790320,15790320,11974326,14079702,14079702,0,14079702,14079702,11974326,15790320,14079702,14079702,0,0,0,14079702,14079702,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'last_quarter'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3487029,3487029,0,0,0,14079702,14079702,15790320,3487029,3487029,3487029,0,14079702,14079702,15790320,15790320,1907997,1907997,3487029,3487029,14079702,15790320,13553358,15790320,1907997,3487029,3487029,3487029,14079702,15790320,13553358,15790320,3487029,3487029,3487029,3487029,14079702,14079702,15790320,15790320,3487029,1907997,3487029,3487029,0,14079702,14079702,13553358,3487029,3487029,3487029,0,0,0,14079702,14079702,3487029,3487029,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'new_moon' %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,2763306,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,2763306,2763306,0,2763306,2763306,2763306,2763306,1842204,1842204,2763306,2763306,2763306,2763306,1842204,2763306,1842204,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,2763306,1842204,2763306,2763306,0,2763306,2763306,1842204,2763306,2763306,2763306,0,0,0,2763306,2763306,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,2763306,2763306,0,14079702,14079702,2763306,2763306,1842204,1842204,2763306,2763306,14079702,15790320,1842204,2763306,1842204,2763306,2763306,2763306,14079702,15790320,1842204,2763306,2763306,2763306,2763306,2763306,14079702,14079702,2763306,2763306,2763306,1842204,2763306,2763306,0,14079702,14079702,1842204,2763306,2763306,2763306,0,0,0,14079702,14079702,2763306,2763306,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waning_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,14079702,14079702,3552822,3552822,0,0,0,14079702,14079702,15790320,15790320,3552822,3552822,0,14079702,14079702,15790320,15790320,13421772,13421772,3552822,3552822,14079702,15790320,13421772,15790320,13421772,15790320,3552822,3552822,14079702,15790320,13421772,15790320,15790320,15790320,3552822,3552822,14079702,14079702,15790320,15790320,15790320,13421772,3552822,3552822,0,14079702,14079702,13421772,15790320,3552822,3552822,0,0,0,14079702,14079702,3552822,3552822,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_crescent'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,3355443,3355443,14079702,14079702,0,3355443,3355443,3355443,3355443,1644825,1644825,14079702,14079702,3355443,3355443,1644825,3355443,1644825,3355443,15790320,14079702,3355443,3355443,1644825,3355443,3355443,3355443,15790320,14079702,3355443,3355443,3355443,3355443,3355443,1644825,14079702,14079702,0,3355443,3355443,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n  {%- if phase == 'waxing_gibbous'  %}\n    {\"db\":[{{x}},{{y}},8,8,[0,0,3355443,3355443,14079702,14079702,0,0,0,3355443,3355443,14079702,15790320,14079702,14079702,0,3355443,3355443,15790320,15790320,12763842,12763842,14079702,14079702,3355443,3355443,12763842,15790320,12763842,15790320,15790320,14079702,3355443,3355443,12763842,15790320,15790320,15790320,15790320,14079702,3355443,3355443,15790320,15790320,15790320,12763842,14079702,14079702,0,3355443,3355443,12763842,15790320,14079702,14079702,0,0,0,3355443,3355443,14079702,14079702,0,0]]}\n  {%- endif  %}\n{%- endmacro %}\n{%- if current_condition == 'clear-night' and use_moon_clear_night -%} {{draw_moon(moon_phase,0,0)}} {%- elif(sun_next_event == 'sunrise') and use_moon_sunny_night and (current_condition == 'sunny') -%} {{draw_moon(moon_phase,0,0)}} {%- else -%} {{draw_moon(moon_phase,23,0)}} {%- endif -%}\n"
            },
            "triggers": [
              {
                "platform": "time_pattern",
                "seconds": "/5"
              },
              {
                "platform": "state",
                "entity_id": "weather.forecast_home",
                "id": "Changes",
                "enabled": true
              }
            ],
            "actions": [
              {
                "target": {
                  "entity_id": "{{forecast_var}}"
                },
                "data": {
                  "type": "hourly"
                },
                "response_variable": "forecast_response",
                "action": "weather.get_forecasts"
              },
              {
                "repeat": {
                  "for_each": "{{ topics }}",
                  "sequence": [
                    {
                      "data": {
                        "topic": "{{repeat.item}}",
                        "payload": "{%- set forecast = forecast_response[forecast_var]['forecast'] -%} {%- macro interpolate(dictionary, x) -%} {%- set sorted_keys = dictionary|dictsort -%} {%- set above = sorted_keys|selectattr('0', 'gt', x)|map(attribute='0')|list|first -%} {%- set below = sorted_keys|selectattr('0', 'lt', x)|map(attribute='0')|list|last -%}\n{#- Key matches x exactly -#} {%- if above is defined and dictionary[above] == x -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{%- elif below is defined and dictionary[below] == x -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Interpolation between two values -#} {%- elif below is defined and above is defined -%}\n  {%- set lower_value = dictionary[below] -%}\n  {%- set upper_value = dictionary[above] -%}\n  {%- set lower_rgb = lower_value[1:] -%}\n  {%- set upper_rgb = upper_value[1:] -%}\n\n  {%- set lower_r = lower_rgb[0:2]|int(base=16) -%}\n  {%- set lower_g = lower_rgb[2:4]|int(base=16) -%}\n  {%- set lower_b = lower_rgb[4:6]|int(base=16) -%}\n\n  {%- set upper_r = upper_rgb[0:2]|int(base=16) -%}\n  {%- set upper_g = upper_rgb[2:4]|int(base=16) -%}\n  {%- set upper_b = upper_rgb[4:6]|int(base=16) -%}\n\n  {%- set interpolation_factor = (x - below) / (above - below) -%}\n  {%- set interpolated_r = ((1 - interpolation_factor) * lower_r + interpolation_factor * upper_r)|int -%}\n  {%- set interpolated_g = ((1 - interpolation_factor) * lower_g + interpolation_factor * upper_g)|int -%}\n  {%- set interpolated_b = ((1 - interpolation_factor) * lower_b + interpolation_factor * upper_b)|int -%}\n\n  {%- set interpolated_hex = '#' ~ '%02X' % interpolated_r ~ '%02X' % interpolated_g ~ '%02X' % interpolated_b -%}\n  {{ interpolated_hex }}\n{#- Only below key available -#} {%- elif below is defined -%}\n  {%- set value = dictionary[below] -%}\n  {{ value }}\n{#- Only above key available -#} {%- elif above is defined -%}\n  {%- set value = dictionary[above] -%}\n  {{ value }}\n{#- No matching keys available -#} {%- else -%}\n  No matching key found.\n{%- endif -%} {%- endmacro -%}\n{#- Define macro to get length of the forecast -#} {%- macro str_len(stringo) %} {%- if '.' in stringo %} {%- set char_count = (stringo | length) -1 %}{{char_count * 3 + 1 + char_count}} {%- else %} {%- set char_count = (stringo | length) %}{{char_count * 3 + (char_count - 1)}} {%- endif %} {%- endmacro %}\n{#- Define a macro to draw out the forecast lines#}\n  {%- macro draw_forecast_lines(x,hours,height) %}\n    {%- for hour in range(hours) %}\n      {%- if height == 0 %}\n        {\"dp\": [{{x+hour}},7,\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- else %}\n        {\"dl\": [{{x+hour}},7,{{x+hour}},{{7 - height}},\"{{interpolate(color_dict, forecast[hour]['temperature']) }}\"]}\n      {%- endif %}\n      {%- if hour+1 != hours %},{%endif%}\n    {%- endfor %}\n  {%- endmacro %}\n\n  {\n    \"draw\": [\n      {%- if hours_to_show > 0 %}\n      {{draw_forecast_lines(8,hours_to_show,0)}}\n    {%- endif %}\n    {%- if current_temp != 'unavailable' -%}\n    ,{\"dt\":[{{text_x}},1,\"{{temp_text}}\",\"{{interpolate(color_dict, current_temp | float)}}\"]}\n    {%- else -%}\n    {\"dt\":\"err\"}\n    {%- endif -%}\n\n    {% if show_moon %}\n    ,{{moon_data}}\n    {% endif %}\n    ],\n    \"icon\": \"{{icon}}\",\n    \"duration\": {{message_duration}},\n    \"pushIcon\": 2,\n    \"lifetime\": 120,\n    \"lifetimeMode\":1,\n    \"weather\": \"{{current_condition}}\"\n    }"
                      },
                      "action": "mqtt.publish"
                    },
                    {
                      "data": {
                        "qos": 0,
                        "retain": false,
                        "topic": "{{ repeat.item ~ '_sun'}} ",
                        "payload": "{{sun_payload}}\n"
                      },
                      "action": "mqtt.publish"
                    }
                  ]
                }
              }
            ],
            "conditions": [],
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather"
          },
          "blueprint_inputs": {
            "id": "1710004236293",
            "alias": "awtrix_mega_weather",
            "description": "from HA community awtrix mega weather",
            "use_blueprint": {
              "path": "jeeftor/awtrix_weatherflow.yaml",
              "input": {
                "awtrix": [
                  "a8583420298728779e89f960f8079d14"
                ],
                "forecast_var": "weather.forecast_home",
                "forecast_temp_field": "temperature",
                "temp_suffix": "\u00b0",
                "current_temp_var": "sensor.kflwildw56_local_temperature",
                "moon": "sensor.moon_phase",
                "moon_rise_set": "sensor.ip_geo_location",
                "show_sun_rise_set": false,
                "message_duration_riseset": 0,
                "message_duration_forecast": 10,
                "hours_to_show": 12,
                "temp_digits": 0
              }
            }
          },
          "context": {
            "id": "01K2PYGS05JY9CME0WG83TZDQA",
            "parent_id": null,
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/1/repeat/sequence/1",
          "run_id": "4ac34888690064c7b43ccdc693bc4428",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:25:45.094052+00:00",
            "finish": "2025-08-15T13:25:45.118808+00:00"
          },
          "domain": "automation",
          "item_id": "1710004236293",
          "trigger": "time pattern"
        }
      }
    ],
    "automation.auto_adj_lvrm_brightness": [
      {
        "extended_dict": {
          "last_step": "action/0",
          "run_id": "1ce0f13328fac0b1eb2b34c2a5ea990f",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:56.662152+00:00",
            "finish": "2025-08-15T13:24:56.743507+00:00"
          },
          "domain": "automation",
          "item_id": "auto_adj_lvrm_brightness",
          "trigger": "state of sensor.lv_rm_suggested_brightness",
          "trace": {
            "trigger/0": [
              {
                "path": "trigger/0",
                "timestamp": "2025-08-15T13:24:56.662200+00:00",
                "changed_variables": {
                  "this": {
                    "entity_id": "automation.auto_adj_lvrm_brightness",
                    "state": "on",
                    "attributes": {
                      "id": "auto_adj_lvrm_brightness",
                      "last_triggered": "2025-08-15T13:15:51.322115+00:00",
                      "mode": "single",
                      "current": 0,
                      "friendly_name": "auto adj lvrm brightness",
                      "initial_state": "on"
                    },
                    "last_changed": "2025-08-15T13:24:10.877770+00:00",
                    "last_reported": "2025-08-15T13:24:10.877770+00:00",
                    "last_updated": "2025-08-15T13:24:10.877770+00:00",
                    "context": {
                      "id": "01K2PYDWZXTWR91V76NF394YFW",
                      "parent_id": null,
                      "user_id": null
                    }
                  },
                  "trigger": {
                    "id": "0",
                    "idx": "0",
                    "alias": null,
                    "platform": "state",
                    "entity_id": "sensor.lv_rm_suggested_brightness",
                    "from_state": {
                      "entity_id": "sensor.lv_rm_suggested_brightness",
                      "state": "30",
                      "attributes": {
                        "unit_of_measurement": "%",
                        "friendly_name": "lv_rm_suggested_brightness"
                      },
                      "last_changed": "2025-08-15T13:24:22.239628+00:00",
                      "last_reported": "2025-08-15T13:24:22.239628+00:00",
                      "last_updated": "2025-08-15T13:24:22.239628+00:00",
                      "context": {
                        "id": "01K2PYE82Z53YSF6S1QEP5QRTP",
                        "parent_id": null,
                        "user_id": null
                      }
                    },
                    "to_state": {
                      "entity_id": "sensor.lv_rm_suggested_brightness",
                      "state": "20",
                      "attributes": {
                        "unit_of_measurement": "%",
                        "friendly_name": "lv_rm_suggested_brightness"
                      },
                      "last_changed": "2025-08-15T13:24:56.661933+00:00",
                      "last_reported": "2025-08-15T13:24:56.661933+00:00",
                      "last_updated": "2025-08-15T13:24:56.661933+00:00",
                      "context": {
                        "id": "01K2PYF9PN3ZCENC8D1WMV24S2",
                        "parent_id": null,
                        "user_id": null
                      }
                    },
                    "for": null,
                    "attribute": null,
                    "description": "state of sensor.lv_rm_suggested_brightness"
                  }
                }
              }
            ],
            "condition/0": [
              {
                "path": "condition/0",
                "timestamp": "2025-08-15T13:24:56.662245+00:00",
                "result": {
                  "result": true
                }
              }
            ],
            "condition/0/entity_id/0": [
              {
                "path": "condition/0/entity_id/0",
                "timestamp": "2025-08-15T13:24:56.662277+00:00",
                "result": {
                  "result": true,
                  "state": "off",
                  "wanted_state": "off"
                }
              }
            ],
            "condition/1": [
              {
                "path": "condition/1",
                "timestamp": "2025-08-15T13:24:56.662325+00:00",
                "result": {
                  "result": true
                }
              }
            ],
            "condition/1/conditions/0": [
              {
                "path": "condition/1/conditions/0",
                "timestamp": "2025-08-15T13:24:56.662339+00:00",
                "result": {
                  "result": true
                }
              }
            ],
            "condition/1/conditions/0/entity_id/0": [
              {
                "path": "condition/1/conditions/0/entity_id/0",
                "timestamp": "2025-08-15T13:24:56.662352+00:00",
                "result": {
                  "result": true,
                  "state": "on",
                  "wanted_state": "on"
                }
              }
            ],
            "action/0": [
              {
                "path": "action/0",
                "timestamp": "2025-08-15T13:24:56.662619+00:00",
                "changed_variables": {
                  "context": {
                    "id": "01K2PYF9PPWKTZNNE137H41768",
                    "parent_id": "01K2PYF9PN3ZCENC8D1WMV24S2",
                    "user_id": null
                  }
                },
                "result": {
                  "params": {
                    "domain": "light",
                    "service": "turn_on",
                    "service_data": {
                      "entity_id": "light.living_room_lights",
                      "brightness_pct": 20
                    },
                    "target": {}
                  },
                  "running_script": false
                }
              }
            ]
          },
          "config": {
            "id": "auto_adj_lvrm_brightness",
            "alias": "auto adj lvrm brightness",
            "initial_state": true,
            "trigger": [
              {
                "platform": "state",
                "entity_id": "sensor.lv_rm_suggested_brightness",
                "to": null
              }
            ],
            "conditions": [
              {
                "condition": "state",
                "entity_id": "input_boolean.party_mode",
                "state": "off"
              },
              {
                "condition": "or",
                "conditions": [
                  {
                    "condition": "state",
                    "entity_id": "light.living_room_lights",
                    "state": "on"
                  },
                  {
                    "condition": "state",
                    "entity_id": "media_player.tv_livingrm",
                    "state": "on"
                  }
                ]
              }
            ],
            "actions": [
              {
                "action": "light.turn_on",
                "data": {
                  "entity_id": "light.living_room_lights",
                  "brightness_pct": "{{ states('sensor.lv_rm_suggested_brightness') | int(default=0) }}"
                }
              }
            ]
          },
          "blueprint_inputs": null,
          "context": {
            "id": "01K2PYF9PPWKTZNNE137H41768",
            "parent_id": "01K2PYF9PN3ZCENC8D1WMV24S2",
            "user_id": null
          }
        },
        "short_dict": {
          "last_step": "action/0",
          "run_id": "1ce0f13328fac0b1eb2b34c2a5ea990f",
          "state": "stopped",
          "script_execution": "finished",
          "timestamp": {
            "start": "2025-08-15T13:24:56.662152+00:00",
            "finish": "2025-08-15T13:24:56.743507+00:00"
          },
          "domain": "automation",
          "item_id": "auto_adj_lvrm_brightness",
          "trigger": "state of sensor.lv_rm_suggested_brightness"
        }
      }
    ]
  }
}